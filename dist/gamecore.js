;(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(require,module,exports){
(function(){// Generated by CoffeeScript 1.6.3
var GameCore, Stage, UUID, context2d, support;

context2d = require("./core/context/2d");

support = require("./core/support");

UUID = require("./math/uuid");

Stage = require("./ui/stage");

/*
Game Core base class

@property {Stage} stage
@property {Boolean} fullScreen
@property {Boolean} paused
@property {Context} context
@property {Int} width
@property {Int} heigth
@property {DOMElement} renderer

@example How to create an game core 
    gc = new GameCore() # Creating core
    gc.renderer = document.body # Appends new canvas element to documents body

@example Making canvas full-sized
    gc = new GameCore() # Creating core
    gc.fullScreen = true
*/


GameCore = (function() {
  /*
  GameCore instancec archive
  */

  GameCore.cores = {};

  /*
  Start your application from here.
  
  @param {Object} options
  */


  function GameCore(options) {
    this.options = options != null ? options : {};
    /*
    In the first case we need to generate id for new instance, if it not
     present in options.
    */

    this.id = this.options.id || UUID.generateUniqueId();
    /*
    Setting up a canvas.
    If canvas doesn't present in options then create it.
    */

    this.options.canvas = this.options.canvas || this.createCanvas();
    /*
    Registrating GameCore instance in canvas ang GameCore global.
    */

    this.options.canvas.core = this;
    GameCore.cores[this.id] = this;
    /*
    Setting up framerate
    */

    this.setFramerate();
    /*
    Render tick hooks
    */

    this._render_tick_hooks = {};
    /*
    Stages map
    */

    this._stages = {};
    Object.defineProperty(this, "stage", {
      get: function() {
        var stage;
        if (this._current_stage_id) {
          return this._stages[this._current_stage_id];
        } else {
          stage = new Stage;
          this._current_stage_id = stage.id;
          this.addStage(stage);
          return stage;
        }
      },
      set: function(stage) {
        if (!this._stages[stage.id]) {
          this.addStage(stage);
        }
        return this._current_stage_id = stage.id;
      }
    });
    /*
    */

    Object.defineProperty(this, "fullScreen", {
      get: function() {
        return this._in_the_fullscreen_now;
      },
      set: function(b) {
        if (b === true) {
          window.addEventListener("resize", this._fullScreen_resizer);
          this._in_the_fullscreen_now = true;
          return this.setSize(document.width, document.height);
        } else {
          window.removeEventListener("resize", this._fullScreen_resizer);
          this._in_the_fullscreen_now = false;
          return this.setSize(this.options.width, this.options.height);
        }
      }
    });
    this.fullScreen = this.options.fullScreen;
    /*
    */

    Object.defineProperty(this, "width", {
      get: function() {
        return this.options.canvas.width;
      },
      set: function(width) {
        this.options.canvas.width = width;
        return this.options.canvas.style.width = width + "px";
      }
    });
    /*
    */

    Object.defineProperty(this, "height", {
      get: function() {
        return this.options.canvas.height;
      },
      set: function(height) {
        this.options.canvas.height = height;
        return this.options.canvas.style.height = height + "px";
      }
    });
    if (this.fullScreen) {
      this.options.width = window.width;
      this.options.height = window.height;
    }
    this.setSize(this.options.width, this.options.height);
    /*
    Context element.
    Currently support only Context2d
    */

    Object.defineProperty(this, "context", {
      get: function() {
        if (!this._context) {
          this._context = new context2d({
            canvas: this.options.canvas
          });
        }
        return this._context;
      }
    });
    /*
    */

    Object.defineProperty(this, "paused", {
      get: function() {
        return this._paused || false;
      },
      set: function(paused) {
        return this._paused = paused ? true : false;
      }
    });
    /*
    Renderer element.
    */

    Object.defineProperty(this, "renderer", {
      get: function() {
        return this._parent_node || 'undefined';
      },
      set: function(node) {
        if (!node.tagName) {
          throw Error("Can render only on document elements");
        }
        node.appendChild(this.options.canvas);
        return this._parent_node = node;
      }
    });
    this._onEnterFrame();
  }

  /*
  */


  GameCore.prototype.addStage = function(stage, setCurrent) {
    if (setCurrent == null) {
      setCurrent = false;
    }
    this._stages[stage.id] = stage;
    if (setCurrent) {
      return this.stage = stage.id;
    }
  };

  /*
  Switch pause state
  */


  GameCore.prototype.pause = function() {
    return this.paused = !this.paused;
  };

  /*
  Set's framerate. Not usable at the moment...
  @param {Int} framerate
  @method setFramerate
  */


  GameCore.prototype.setFramerate = function(framerate) {
    if (framerate == null) {
      framerate = 60;
    }
    return window._FPS = framerate;
  };

  /*
  Set size of an canvas element.
  @param {Int} width
  @param {Int} height
  @method setSize
  */


  GameCore.prototype.setSize = function(width, height) {
    if (width == null) {
      width = 400;
    }
    if (height == null) {
      height = 300;
    }
    this.width = width;
    return this.height = height;
  };

  GameCore.prototype._fullScreen_resizer = function() {
    var gci;
    gci = this;
    return function(e) {
      return gci.setSize(window.width, window.height);
    };
  };

  /*
  Creates a canvas element
  @method createCanvas
  */


  GameCore.prototype.createCanvas = function() {
    var canvas;
    canvas = document.createElement('canvas');
    return canvas;
  };

  /*
  Add render tick hook
  
  @method addRenderTickHook
  @param {String} name
  @param {Function} functor
  
  @note Render tick hooks calls after stage was rendered
  */


  GameCore.prototype.addRenderTickHook = function(name, functor) {
    return this._render_tick_hooks[name] = functor;
  };

  /*
  Removes render tick hook
  @method removeRenderTickHook
  @param {String} name
  */


  GameCore.prototype.removeRenderTickHook = function(name) {
    return delete this._render_tick_hooks[name];
  };

  /*
  Call window's requestAnimationFrame.
  @method _onEnterFrame
  */


  GameCore.prototype._onEnterFrame = function(gci) {
    if (gci == null) {
      gci = this;
    }
    if (!this.paused) {
      gci._render(gci.stage);
    }
    return window.onEnterFrame(function() {
      return gci._onEnterFrame(gci);
    });
  };

  GameCore.prototype._render = function() {
    var hook, name, _ref, _results;
    this.context.render([this.stage]);
    _ref = this._render_tick_hooks;
    _results = [];
    for (name in _ref) {
      hook = _ref[name];
      _results.push(hook.call());
    }
    return _results;
  };

  return GameCore;

})();

window.GameCore = window.GameCore || GameCore;

GameCore.exports = {
  UI: require("./ui/exports"),
  Math: require("./math/exports")
};

module.exports = GameCore;

/*
//@ sourceMappingURL=core.map
*/

})()
},{"./core/context/2d":2,"./core/support":3,"./math/exports":4,"./math/uuid":6,"./ui/exports":9,"./ui/stage":13}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Context2d;

Context2d = (function() {
  function Context2d(options) {
    this.setCanvas(options.canvas);
  }

  Context2d.prototype.setCanvas = function(canvas) {
    this.canvas = canvas;
    this.ctx = this.canvas.getContext('2d');
    return this;
  };

  Context2d.prototype.clear = function() {
    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);
    return this;
  };

  Context2d.prototype.render = function(layers) {
    var layer, _i, _len, _results;
    if (layers == null) {
      layers = [];
    }
    this.clear();
    _results = [];
    for (_i = 0, _len = layers.length; _i < _len; _i++) {
      layer = layers[_i];
      _results.push(layer.render(this.ctx));
    }
    return _results;
  };

  return Context2d;

})();

module.exports = Context2d;

/*
//@ sourceMappingURL=2d.map
*/

},{}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var browserPrefix, prefix, userAgent;

prefix = function(name) {
  if (browserPrefix !== "") {
    name = name.charAt(0).toUpperCase() + name.slice(1);
  }
  return browserPrefix + name;
};

userAgent = navigator.userAgent;

browserPrefix = (userAgent.match(/opera/i) && "o") || (userAgent.match(/webkit/i) && "webkit") || (userAgent.match(/msie/i) && "ms") || (userAgent.match(/mozilla/i) && "moz") || "";

Function.prototype.property = function(prop, desc) {
  return Object.defineProperty(this.prototype, prop, desc);
};

if (typeof window.addEventListener !== "function") {
  HTMLElement.prototype.addEventListener = function(type, callback, useCapture) {
    return attachEvent("on" + type, callback);
  };
}

/*
window.onEnterFrame
*/


window.onEnterFrame = (function() {
  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
    return window.setTimeout(callback, 1000 / window._FPS);
  };
})();

module.exports = {
  /*
  Browser's user-agent string
  @attribute userAgent
  @type {String}
  @static
  @readonly
  */

  userAgent: userAgent,
  /*
  Device supports touch events?
  @attribute touch
  @type {Boolean}
  @static
  @readonly
  */

  touch: "ontouchstart" in window,
  /*
  Device supports Retina Display?
  @attribute retina
  @type {Boolean}
  @static
  @readonly
  */

  retina: window.devicePixelRatio > 1 || window.matchMedia("(min-resolution: 1.1dppx)").matches,
  imageSmoothingEnabled: prefix("imageSmoothingEnabled")
};

/*
//@ sourceMappingURL=support.map
*/

},{}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
module.exports = {
  Matrix2D: require("./matrix2d"),
  Vector2D: require("./vector2d"),
  UUID: require("./uuid")
};

/*
//@ sourceMappingURL=exports.map
*/

},{"./matrix2d":5,"./uuid":6,"./vector2d":7}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Matrix2D;

Matrix2D = (function() {
  /*
  Based on [EaselJS](https://github.com/CreateJS/EaselJS/) Matrix2D implementation.
  
  @class Matrix2D
  @constructor
  
  @param {Number} m11
  @param {Number} m12
  @param {Number} m21
  @param {Number} m22
  @param {Number} dx
  @param {Number} dy
  */

  function Matrix2D(m11, m12, m21, m22, dx, dy) {
    if (m11 !== null) {
      this.m11 = m11;
    }
    this.m12 = m12 || 0;
    this.m21 = m21 || 0;
    if (m22 !== null) {
      this.m22 = m22;
    }
    this.dx = dx || 0;
    this.dy = dy || 0;
  }

  /*
  Generates matrix properties from the specified display object transform properties, and appends them with this matrix.
  For example, you can use this to generate m11 matrix from m11 display object: var mtx = new Matrix2D();
  mtx.appendTransform(o.x, o.y, o.scaleX, o.scaleY, o.rotation);
  @method appendTransform
  @param {Number} x
  @param {Number} y
  @param {Number} scaleX
  @param {Number} scaleY
  @param {Number} rotation
  @param {Number} skewX
  @param {Number} skewY
  @param {Number} pivotX Optional.
  @param {Number} pivotY Optional.
  @return {Matrix2D} This matrix. Useful for chaining method calls.
  */


  Matrix2D.prototype.appendTransform = function(x, y, scaleX, scaleY, rotation, skewX, skewY, pivotX, pivotY) {
    var cos, r, sin;
    cos = void 0;
    sin = void 0;
    r = void 0;
    if (rotation % 360) {
      r = rotation * Matrix2D.DEG_TO_RAD;
      cos = Math.cos(r);
      sin = Math.sin(r);
    } else {
      cos = 1;
      sin = 0;
    }
    if (skewX || skewY) {
      skewX *= Matrix2D.DEG_TO_RAD;
      skewY *= Matrix2D.DEG_TO_RAD;
      this.append(Math.cos(skewY), Math.sin(skewY), -Math.sin(skewX), Math.cos(skewX), x, y);
      this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, 0, 0);
    } else {
      this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, x, y);
    }
    if (pivotX || pivotY) {
      this.dx -= pivotX * this.m11 + pivotY * this.m21;
      this.dy -= pivotX * this.m12 + pivotY * this.m22;
    }
    return this;
  };

  /*
  Appends the specified matrix properties with this matrix. All parameters are required.
  @method append
  @param {Number} m11
  @param {Number} m12
  @param {Number} m21
  @param {Number} m22
  @param {Number} dx
  @param {Number} dy
  @return {Matrix2D} This matrix. Useful for chaining method calls.
  */


  Matrix2D.prototype.append = function(m11, m12, m21, m22, dx, dy) {
    var a1, b1, c1, d1;
    a1 = this.m11;
    b1 = this.m12;
    c1 = this.m21;
    d1 = this.m22;
    this.m11 = m11 * a1 + m12 * c1;
    this.m12 = m11 * b1 + m12 * d1;
    this.m21 = m21 * a1 + m22 * c1;
    this.m22 = m21 * b1 + m22 * d1;
    this.dx = dx * a1 + dy * c1 + this.dx;
    this.dy = dx * b1 + dy * d1 + this.dy;
    return this;
  };

  /*
  Inverts the matrix, causing it to perform the opposite transformation.
  @method invert
  @return {Matrix2D} this
  */


  Matrix2D.prototype.invert = function() {
    var a1, b1, c1, d1, n, tx1;
    a1 = this.m11;
    b1 = this.m12;
    c1 = this.m21;
    d1 = this.m22;
    tx1 = this.dx;
    n = a1 * d1 - b1 * c1;
    this.m11 = d1 / n;
    this.m12 = -b1 / n;
    this.m21 = -c1 / n;
    this.m22 = a1 / n;
    this.dx = (c1 * this.dy - d1 * tx1) / n;
    this.dy = -(a1 * this.dy - b1 * tx1) / n;
    return this;
  };

  /*
  Clone Matrix2D instance
  @return {Matrix2D}
  */


  Matrix2D.prototype.clone = function() {
    return new Matrix2D(this.m11, this.m12, this.m21, this.m22, this.dx, this.dy);
  };

  /*
  Reset matrix to it's identity
  @return {Matrix2D} this
  */


  Matrix2D.prototype.identity = function() {
    this.m11 = this.m22 = 1;
    this.m12 = this.m21 = this.dx = this.dy = 0;
    return this;
  };

  /*           
  Multiplier for converting degrees to radians. Used internally by Matrix2D.
  
  @attribute DEG_TO_RAD
  @static
  @readonly
  @return {Number}
  */


  Matrix2D.DEG_TO_RAD = Math.PI / 180;

  Matrix2D.identity = new Matrix2D(1, 0, 0, 1, 0, 0);

  return Matrix2D;

})();

module.exports = Matrix2D;

/*
//@ sourceMappingURL=matrix2d.map
*/

},{}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var UUID;

UUID = (function() {
  function UUID() {}

  /*
  @method generateUniqueId
  @return {String}
  */


  UUID.generateUniqueId = function() {
    return "gc-" + this.uuid();
  };

  /*
  @method uuid
  @return {String}
  */


  UUID.uuid = function() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      var r, v;
      r = Math.random() * 16 | 0;
      v = c === 'x' ? r : r & 0x3 | 0x8;
      return v.toString(16);
    });
  };

  return UUID;

})();

module.exports = UUID;

/*
//@ sourceMappingURL=uuid.map
*/

},{}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Vector2d;

Vector2d = (function() {
  function Vector2d(x, y) {
    this.x = x != null ? x : 0;
    this.y = y != null ? y : 0;
    /*
    Get the magnitude of this vector
    @attribute length
    @readonly
    */

    Object.defineProperty(this, "length", {
      get: function() {
        return Math.sqrt((this.x * this.x) + (this.y * this.y));
      },
      configurable: true
    });
    /*
    Get this vector with a magnitude of 1.
    @attribute normalized
    @readonly
    */

    Object.defineProperty(this, "normalized", {
      get: function() {
        var magnitude;
        magnitude = this.length;
        return new Vector2d(this.x / magnitude, this.y / magnitude);
      },
      configurable: true
    });
  }

  /*
  @method set
  @param {Number} x
  @param {Number} y
  @return {Vector2d}
  */


  Vector2d.prototype.set = function(x, y) {
    this.x = x;
    this.y = y;
  };

  /*
  @method sum
  @param {Vector2d} vector2d
  @return {Vector2d}
  */


  Vector2d.prototype.subtract = function(vector2d) {
    this.x -= vector2d.x;
    return this.y -= vector2d.y;
  };

  /*
  @method sum
  @param {Vector2d} vector2d
  @return {Vector2d}
  */


  Vector2d.prototype.sum = function(vector2d) {
    this.x += vector2d.x;
    return this.y += vector2d.y;
  };

  /*
  @method scale
  @param {Number} x (or x y)
  @param {Number} y
  @return {Vector2d}
  */


  Vector2d.prototype.scale = function(x, y) {
    this.x *= x;
    return this.y *= y || x;
  };

  /*
  @method clone
  @return {Vector2d}
  */


  Vector2d.prototype.clone = function() {
    return new Vector2d(this.x, this.y);
  };

  /*
  Return unit vector
  @return {Vector2d}
  */


  Vector2d.prototype.unit = function() {
    return new Vector2d(Math.cos(this.x), Math.sin(this.y));
  };

  /*
  Normalize this vector
  @return {Vector2d}
  */


  Vector2d.prototype.normalize = function() {
    var normal;
    normal = this.normalized;
    this.x = normal.x;
    return this.y = normal.y;
  };

  /*
  Get the distance between this vector and the argument vector
  @param {Vector2d} vector
  @return {Number}
  */


  Vector2d.distance = function(v1, v2) {
    var xdiff, ydiff;
    xdiff = v1.x - v2.x;
    ydiff = v1.y - v2.y;
    return Math.sqrt(xdiff * xdiff + ydiff * ydiff);
  };

  /*
  @method toString
  @return {String}
  */


  Vector2d.prototype.toString = function() {
    return "#<Vector2d @x=" + this.x + ", @y=" + this.y + ">";
  };

  Vector2d.LEFT = new Vector2d(-1, 0);

  Vector2d.RIGHT = new Vector2d(1, 0);

  Vector2d.TOP = new Vector2d(0, -1);

  Vector2d.BOTTOM = new Vector2d(0, 1);

  return Vector2d;

})();

module.exports = Vector2d;

/*
//@ sourceMappingURL=vector2d.map
*/

},{}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Container, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("./widget");

Container = (function(_super) {
  __extends(Container, _super);

  function Container(options) {
    if (options == null) {
      options = {};
    }
    Container.__super__.constructor.call(this, options);
    this.children = {};
  }

  Container.prototype.addChild = function(child) {
    if (child.parent === !this) {
      return child.parent = this;
    } else {
      return this.children[child.id] = child;
    }
  };

  Container.prototype.render = function(ctx) {
    var child, cid, _ref, _results;
    Container.__super__.render.call(this, ctx);
    _ref = this.children;
    _results = [];
    for (cid in _ref) {
      child = _ref[cid];
      _results.push(child.render(ctx));
    }
    return _results;
  };

  return Container;

})(Widget);

module.exports = Container;

/*
//@ sourceMappingURL=container.map
*/

},{"./widget":15}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
module.exports = {
  Widget: require("./widget"),
  Stage: require("./stage"),
  Container: require("./container"),
  Text: require("./text"),
  geometry: require("./geometry/exports")
};

/*
//@ sourceMappingURL=exports.map
*/

},{"./container":8,"./geometry/exports":11,"./stage":13,"./text":14,"./widget":15}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Circle, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("../widget");

Circle = (function(_super) {
  __extends(Circle, _super);

  function Circle(options) {
    if (options == null) {
      options = {};
    }
    Circle.__super__.constructor.call(this, options);
  }

  return Circle;

})(Widget);

/*
//@ sourceMappingURL=circle.map
*/

},{"../widget":15}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
module.exports = {
  Circle: require("./circle"),
  Rect: require("./rect")
};

/*
//@ sourceMappingURL=exports.map
*/

},{"./circle":10,"./rect":12}],12:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Rect, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("../widget");

Rect = (function(_super) {
  __extends(Rect, _super);

  function Rect(options) {
    if (options == null) {
      options = {};
    }
    Rect.__super__.constructor.call(this, options);
  }

  return Rect;

})(Widget);

/*
//@ sourceMappingURL=rect.map
*/

},{"../widget":15}],13:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Stage, container,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

container = require("../ui/container");

Stage = (function(_super) {
  __extends(Stage, _super);

  function Stage(options) {
    if (options == null) {
      options = {};
    }
    Stage.__super__.constructor.call(this, options);
    this.x = 0;
    this.y = 0;
  }

  Stage.prototype.render = function(ctx) {
    this.width = ctx.canvas.width;
    this.height = ctx.canvas.height;
    return Stage.__super__.render.call(this, ctx);
  };

  return Stage;

})(container);

module.exports = Stage;

/*
//@ sourceMappingURL=stage.map
*/

},{"../ui/container":8}],14:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var BASELINE, DEFAULT_ALIGN, DEFAULT_BASELINE, DEFAULT_COLOR, DEFAULT_FONT, Text, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("./widget");

/*
Object.defineProperty this, BASELINE
@static
*/


BASELINE = {
  /*
  Object.defineProperty this, BASELINE.TOP
  @type {String}
  @static
  */

  TOP: "top",
  /*
  Object.defineProperty this, BASELINE.HANGING
  @type {String}
  @static
  */

  HANGING: "hanging",
  /*
  Object.defineProperty this, BASELINE.MIDDLE
  @type {String}
  @static
  */

  MIDDLE: "middle",
  /*
  Object.defineProperty this, BASELINE.ALPHABETIC
  @type {String}
  @static
  */

  ALPHABETIC: "alphabetic",
  /*
  Object.defineProperty this, BASELINE.IDEOGRAPHIC
  @type {String}
  @static
  */

  IDEOGRAPHIC: "ideographic",
  /*
  Object.defineProperty this, BASELINE.BOTTOM
  @type {String}
  @static
  */

  BOTTOM: "bottom"
};

DEFAULT_FONT = "Normal 12px Verdana";

DEFAULT_COLOR = "#000000";

DEFAULT_ALIGN = "left";

DEFAULT_BASELINE = BASELINE.TOP;

Text = (function(_super) {
  __extends(Text, _super);

  /*
  @class Text
  @extends DisplayObject
  
  @param {Object} options any attribute may be initialized by option
  @param {String} [options.text] default - ""
  @param {String} [options.font] default - "Normal 12px Verdana"
  @param {String} [options.align] default - "left"
  @param {String} [options.baseline] default - Joy.Text.BASELINE.TOP
  @param {String} [options.color] default - #000000
  
  @constructor
  */


  function Text(options) {
    if (options == null) {
      options = {};
    }
    Text.__super__.constructor.call(this, options);
    /*
    Text to be displayed
    @attribute text
    @default ""
    @type {String}
    */

    this.text = options.text || "";
    /*
    Font family and size
    @attribute font
    @default "Normal 12px Verdana"
    @type {String}
    */

    this.font = options.font || DEFAULT_FONT;
    /*
    Text horizontal alignment
    @attribute align
    @default "left"
    @type {String}
    */

    this.align = options.align || DEFAULT_ALIGN;
    /*
    Text vertical baseline
    @attribute baseline
    @default Joy.Text.BASELINE.TOP
    @type {String}
    */

    this.baseline = options.baseline || DEFAULT_BASELINE;
    /*
    Color of the text
    @attribute color
    @default "#000000"
    @type {String, Color}
    */

    this._color = options.color || DEFAULT_COLOR;
    Object.defineProperty(this, "color", {
      get: function() {
        return this._color;
      },
      set: function(color) {
        return this._color = color.toString();
      },
      configurable: true
    });
    if (options.stroke) {
      this.useStroke();
    } else {
      this.useFill();
    }
    Object.defineProperty(this, "width", {
      get: function() {
        if (this.__measure) {
          return this.__measure.width;
        } else {
          return 0;
        }
      }
    });
    Object.defineProperty(this, "height", {
      get: function() {
        if (this.__measure) {
          return this.__measure.height;
        } else {
          return 0;
        }
      }
    });
  }

  /*
  @method useStroke
  */


  Text.prototype.useStroke = function() {
    this.stroke = true;
    this.fillMethod = "strokeText";
    return this.styleMethod = "strokeStyle";
  };

  /*
  @method useFill
  */


  Text.prototype.useFill = function() {
    this.stroke = false;
    this.fillMethod = "fillText";
    return this.styleMethod = "fillStyle";
  };

  Text.prototype._render = function(ctx) {
    ctx.font = this.font;
    ctx.textAlign = this.align;
    ctx.textBaseline = this.baseline;
    ctx[this.styleMethod] = this.color;
    ctx[this.fillMethod](this.text, 0, 0);
    return this.getMeasure(ctx);
  };

  /*
  @method getMeasure
  @return {TextMetrics} text metrics
  */


  Text.prototype.getMeasure = function(ctx) {
    var m;
    this.__measure = {};
    m = Text.MeasureText(this.text, this.font);
    this.__measure.width = m[0];
    return this.__measure.height = m[1];
  };

  Text.BASELINE = BASELINE;

  Text.MeasureText = function(text, font) {
    var div, size, str;
    str = text + ":" + font;
    if (typeof this.__measuretext_cache__ === "object" && this.__measuretext_cache__[str]) {
      return this.__measuretext_cache__[str];
    }
    div = document.createElement("DIV");
    div.innerHTML = text;
    div.style.position = "absolute";
    div.style.top = "-100px";
    div.style.left = "-100px";
    div.style.font = font;
    console.log(div.style.fontFamily, div.style.fontWeight, div.style.fontSize);
    document.body.appendChild(div);
    size = [div.offsetWidth, div.offsetHeight];
    document.body.removeChild(div);
    if (typeof this.__measuretext_cache__ !== "object") {
      this.__measuretext_cache__ = {};
    }
    this.__measuretext_cache__[str] = size;
    return size;
  };

  return Text;

})(Widget);

module.exports = Text;

/*
//@ sourceMappingURL=text.map
*/

},{"./widget":15}],15:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Color, Core, Matrix2d, Support, UUID, Vector2d, Widget;

Core = require("../core");

UUID = require("../math/uuid");

Vector2d = require("../math/vector2d");

Matrix2d = require("../math/matrix2d");

Support = require("../core/support");

Color = require("../utils/color");

/*
Base renderable element
*/


Widget = (function() {
  function Widget(options) {
    if (options == null) {
      options = {};
    }
    this.id = UUID.generateUniqueId();
    /*
    @attribute pivot
    @type {Vector2d}
    @default 0,0
    */

    this.pivot = options.pivot || new Vector2d(options.pivotX || 0, options.pivotY || 0);
    /*
    @attribute skewX
    @type {Number}
    @default 0
    */

    this.skew = options.skew || new Vector2d(options.skewX || 0, options.skewY || 0);
    /*
    @attribute scale
    @type {Vector2d}
    @default 1,1
    */

    this.scale = options.scale || new Vector2d(options.scaleX || 1, options.scaleY || 1);
    /*
    @attribute alpha
    @type {Number}
    @default 1
    */

    this.alpha = (typeof options.alpha === "undefined" ? 1 : options.alpha);
    /*
    @attribute rotation
    @type {Number}
    @default 0
    */

    this.rotation = options.rotation || 0;
    /*
    @attribute smooth
    @type {Boolean}
    @default false
    */

    this.smooth = (typeof options.smooth === "undefined" ? true : options.smooth);
    this._matrix = Matrix2d.identity.clone();
    Object.defineProperty(this, "position", {
      get: function() {
        if (!this._position) {
          this._position = new Vector2d(0, 0);
        }
        return this._position;
      },
      set: function(vector) {
        return this._position = vector.clone();
      }
    });
    Object.defineProperty(this, "x", {
      get: function() {
        return this.position.x || 0;
      },
      set: function(x) {
        return this.position.x = x;
      }
    });
    if (options.x) {
      this.x = options.x;
    }
    Object.defineProperty(this, "y", {
      get: function() {
        return this.position.y || 0;
      },
      set: function(y) {
        return this.position.y = y;
      }
    });
    if (options.y) {
      this.y = options.y;
    }
    Object.defineProperty(this, "width", {
      get: function() {
        return this._width || 10;
      },
      set: function(w) {
        return this._width = w;
      },
      configurable: true
    });
    if (options.width) {
      this.width = options.width;
    }
    Object.defineProperty(this, "height", {
      get: function() {
        return this._height || 10;
      },
      set: function(h) {
        return this._height = h;
      },
      configurable: true
    });
    if (options.height) {
      this.height = options.height;
    }
    Object.defineProperty(this, "parent", {
      get: function() {
        return this._parent || 'undefined';
      },
      set: function(parent) {
        this._parent = parent;
        return this._parent.addChild(this);
      }
    });
    if (options.parent) {
      this.parent = options.parent;
    }
    Object.defineProperty(this, "drawBoundingBox", {
      get: function() {
        return this._bounding_box || false;
      },
      set: function(boool) {
        return this._bounding_box = boool || false;
      }
    });
    if (options.bbox) {
      this.drawBoundingBox = options.bbox;
    }
  }

  Widget.prototype.render = function(ctx) {
    var bit, mtx;
    bit = {
      "false": -1,
      "true": 1
    };
    mtx = this._matrix.clone().identity().appendTransform(this.position.x + this.width * (this.flipX + 0), this.position.y + this.height * (this.flipY + 0), this.scale.x * bit[!this.flipX], this.scale.y * bit[!this.flipY], this.rotation, this.skew.x, this.skew.y, this.pivot.x, this.pivot.y);
    ctx.beginPath();
    ctx.translate(this.position.x, this.position.y);
    ctx.transform(mtx.m11, mtx.m12, mtx.m21, mtx.m22, mtx.dx, mtx.dy);
    ctx.setAlpha(this.alpha);
    if (this.compositeOperation) {
      ctx.globalCompositeOperation = this.compositeOperation;
    }
    ctx[Support.imageSmoothingEnabled] = this.smooth;
    if (this.drawBoundingBox === true) {
      ctx.setAlpha(1);
      ctx.rect(0, 0, this.width, this.height);
    }
    ctx.setAlpha(this.alpha);
    if (this._render) {
      this._render(ctx);
    }
    ctx.translate(-this.position.x, -this.position.y);
    return ctx.closePath();
  };

  return Widget;

})();

module.exports = Widget;

/*
//@ sourceMappingURL=widget.map
*/

},{"../core":1,"../core/support":3,"../math/matrix2d":5,"../math/uuid":6,"../math/vector2d":7,"../utils/color":16}],16:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Color;

Color = (function() {
  /*
  @param {String | Number} hexOrRed hexadecimal color (String), or red (Number)
  @param {Number} green
  @param {Number} blue
  @param {Number} alpha
  
  @example
  // color name
  var color = new Joy.Color("red");
  
  @example
  // hexadecimal
  var color = new Joy.Color("#fff");
  
  @example
  // rgb
  var color = new Joy.Color(255, 50, 255);
  
  @example
  // rgba
  var color = new Joy.Color(255, 50, 255, 100);
  
  @class Color
  @constructor
  */

  function Color(r, g, b, a) {
    this.r = r != null ? r : 0;
    this.g = g != null ? g : 0;
    this.b = b != null ? b : 0;
    this.a = a != null ? a : 1;
  }

  Color.prototype.toString = function() {
    var r;
    if (!this.green && !this.blue) {
      r = this.red;
    } else if (this.alpha) {
      r = "rgba( " + this.red + ", " + this.green + ", " + this.blue + ", " + this.alpha + ")";
    } else {
      r = "rgb( " + this.red + ", " + this.green + ", " + this.blue + ")";
    }
    return r;
  };

  Color.random = function(alpha) {
    if (alpha == null) {
      alpha = 255;
    }
    return new Color(parseInt(Math.random() * 255, 10), parseInt(Math.random() * 255, 10), parseInt(Math.random() * 255, 10), alpha);
  };

  return Color;

})();

module.exports = Color;

/*
//@ sourceMappingURL=color.map
*/

},{}]},{},[1])
//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC9jb3JlLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvY29yZS9jb250ZXh0LzJkLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvY29yZS9zdXBwb3J0LmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvbWF0aC9leHBvcnRzLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvbWF0aC9tYXRyaXgyZC5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL21hdGgvdXVpZC5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL21hdGgvdmVjdG9yMmQuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS9jb250YWluZXIuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS9leHBvcnRzLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvdWkvZ2VvbWV0cnkvY2lyY2xlLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvdWkvZ2VvbWV0cnkvZXhwb3J0cy5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL3VpL2dlb21ldHJ5L3JlY3QuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS9zdGFnZS5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL3VpL3RleHQuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS93aWRnZXQuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91dGlscy9jb2xvci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7Ly8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIEdhbWVDb3JlLCBTdGFnZSwgVVVJRCwgY29udGV4dDJkLCBzdXBwb3J0O1xuXG5jb250ZXh0MmQgPSByZXF1aXJlKFwiLi9jb3JlL2NvbnRleHQvMmRcIik7XG5cbnN1cHBvcnQgPSByZXF1aXJlKFwiLi9jb3JlL3N1cHBvcnRcIik7XG5cblVVSUQgPSByZXF1aXJlKFwiLi9tYXRoL3V1aWRcIik7XG5cblN0YWdlID0gcmVxdWlyZShcIi4vdWkvc3RhZ2VcIik7XG5cbi8qXG5HYW1lIENvcmUgYmFzZSBjbGFzc1xuXG5AcHJvcGVydHkge1N0YWdlfSBzdGFnZVxuQHByb3BlcnR5IHtCb29sZWFufSBmdWxsU2NyZWVuXG5AcHJvcGVydHkge0Jvb2xlYW59IHBhdXNlZFxuQHByb3BlcnR5IHtDb250ZXh0fSBjb250ZXh0XG5AcHJvcGVydHkge0ludH0gd2lkdGhcbkBwcm9wZXJ0eSB7SW50fSBoZWlndGhcbkBwcm9wZXJ0eSB7RE9NRWxlbWVudH0gcmVuZGVyZXJcblxuQGV4YW1wbGUgSG93IHRvIGNyZWF0ZSBhbiBnYW1lIGNvcmUgXG4gICAgZ2MgPSBuZXcgR2FtZUNvcmUoKSAjIENyZWF0aW5nIGNvcmVcbiAgICBnYy5yZW5kZXJlciA9IGRvY3VtZW50LmJvZHkgIyBBcHBlbmRzIG5ldyBjYW52YXMgZWxlbWVudCB0byBkb2N1bWVudHMgYm9keVxuXG5AZXhhbXBsZSBNYWtpbmcgY2FudmFzIGZ1bGwtc2l6ZWRcbiAgICBnYyA9IG5ldyBHYW1lQ29yZSgpICMgQ3JlYXRpbmcgY29yZVxuICAgIGdjLmZ1bGxTY3JlZW4gPSB0cnVlXG4qL1xuXG5cbkdhbWVDb3JlID0gKGZ1bmN0aW9uKCkge1xuICAvKlxuICBHYW1lQ29yZSBpbnN0YW5jZWMgYXJjaGl2ZVxuICAqL1xuXG4gIEdhbWVDb3JlLmNvcmVzID0ge307XG5cbiAgLypcbiAgU3RhcnQgeW91ciBhcHBsaWNhdGlvbiBmcm9tIGhlcmUuXG4gIFxuICBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAqL1xuXG5cbiAgZnVuY3Rpb24gR2FtZUNvcmUob3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMgOiB7fTtcbiAgICAvKlxuICAgIEluIHRoZSBmaXJzdCBjYXNlIHdlIG5lZWQgdG8gZ2VuZXJhdGUgaWQgZm9yIG5ldyBpbnN0YW5jZSwgaWYgaXQgbm90XG4gICAgIHByZXNlbnQgaW4gb3B0aW9ucy5cbiAgICAqL1xuXG4gICAgdGhpcy5pZCA9IHRoaXMub3B0aW9ucy5pZCB8fCBVVUlELmdlbmVyYXRlVW5pcXVlSWQoKTtcbiAgICAvKlxuICAgIFNldHRpbmcgdXAgYSBjYW52YXMuXG4gICAgSWYgY2FudmFzIGRvZXNuJ3QgcHJlc2VudCBpbiBvcHRpb25zIHRoZW4gY3JlYXRlIGl0LlxuICAgICovXG5cbiAgICB0aGlzLm9wdGlvbnMuY2FudmFzID0gdGhpcy5vcHRpb25zLmNhbnZhcyB8fCB0aGlzLmNyZWF0ZUNhbnZhcygpO1xuICAgIC8qXG4gICAgUmVnaXN0cmF0aW5nIEdhbWVDb3JlIGluc3RhbmNlIGluIGNhbnZhcyBhbmcgR2FtZUNvcmUgZ2xvYmFsLlxuICAgICovXG5cbiAgICB0aGlzLm9wdGlvbnMuY2FudmFzLmNvcmUgPSB0aGlzO1xuICAgIEdhbWVDb3JlLmNvcmVzW3RoaXMuaWRdID0gdGhpcztcbiAgICAvKlxuICAgIFNldHRpbmcgdXAgZnJhbWVyYXRlXG4gICAgKi9cblxuICAgIHRoaXMuc2V0RnJhbWVyYXRlKCk7XG4gICAgLypcbiAgICBSZW5kZXIgdGljayBob29rc1xuICAgICovXG5cbiAgICB0aGlzLl9yZW5kZXJfdGlja19ob29rcyA9IHt9O1xuICAgIC8qXG4gICAgU3RhZ2VzIG1hcFxuICAgICovXG5cbiAgICB0aGlzLl9zdGFnZXMgPSB7fTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGFnZVwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhZ2U7XG4gICAgICAgIGlmICh0aGlzLl9jdXJyZW50X3N0YWdlX2lkKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YWdlc1t0aGlzLl9jdXJyZW50X3N0YWdlX2lkXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdGFnZSA9IG5ldyBTdGFnZTtcbiAgICAgICAgICB0aGlzLl9jdXJyZW50X3N0YWdlX2lkID0gc3RhZ2UuaWQ7XG4gICAgICAgICAgdGhpcy5hZGRTdGFnZShzdGFnZSk7XG4gICAgICAgICAgcmV0dXJuIHN0YWdlO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbihzdGFnZSkge1xuICAgICAgICBpZiAoIXRoaXMuX3N0YWdlc1tzdGFnZS5pZF0pIHtcbiAgICAgICAgICB0aGlzLmFkZFN0YWdlKHN0YWdlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudF9zdGFnZV9pZCA9IHN0YWdlLmlkO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8qXG4gICAgKi9cblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImZ1bGxTY3JlZW5cIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luX3RoZV9mdWxsc2NyZWVuX25vdztcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKGIpIHtcbiAgICAgICAgaWYgKGIgPT09IHRydWUpIHtcbiAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLl9mdWxsU2NyZWVuX3Jlc2l6ZXIpO1xuICAgICAgICAgIHRoaXMuX2luX3RoZV9mdWxsc2NyZWVuX25vdyA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc2V0U2l6ZShkb2N1bWVudC53aWR0aCwgZG9jdW1lbnQuaGVpZ2h0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLl9mdWxsU2NyZWVuX3Jlc2l6ZXIpO1xuICAgICAgICAgIHRoaXMuX2luX3RoZV9mdWxsc2NyZWVuX25vdyA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiB0aGlzLnNldFNpemUodGhpcy5vcHRpb25zLndpZHRoLCB0aGlzLm9wdGlvbnMuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuZnVsbFNjcmVlbiA9IHRoaXMub3B0aW9ucy5mdWxsU2NyZWVuO1xuICAgIC8qXG4gICAgKi9cblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIndpZHRoXCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuY2FudmFzLndpZHRoO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24od2lkdGgpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNhbnZhcy5zdHlsZS53aWR0aCA9IHdpZHRoICsgXCJweFwiO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8qXG4gICAgKi9cblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImhlaWdodFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNhbnZhcy5oZWlnaHQ7XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbihoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArIFwicHhcIjtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAodGhpcy5mdWxsU2NyZWVuKSB7XG4gICAgICB0aGlzLm9wdGlvbnMud2lkdGggPSB3aW5kb3cud2lkdGg7XG4gICAgICB0aGlzLm9wdGlvbnMuaGVpZ2h0ID0gd2luZG93LmhlaWdodDtcbiAgICB9XG4gICAgdGhpcy5zZXRTaXplKHRoaXMub3B0aW9ucy53aWR0aCwgdGhpcy5vcHRpb25zLmhlaWdodCk7XG4gICAgLypcbiAgICBDb250ZXh0IGVsZW1lbnQuXG4gICAgQ3VycmVudGx5IHN1cHBvcnQgb25seSBDb250ZXh0MmRcbiAgICAqL1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29udGV4dFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2NvbnRleHQpIHtcbiAgICAgICAgICB0aGlzLl9jb250ZXh0ID0gbmV3IGNvbnRleHQyZCh7XG4gICAgICAgICAgICBjYW52YXM6IHRoaXMub3B0aW9ucy5jYW52YXNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY29udGV4dDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvKlxuICAgICovXG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJwYXVzZWRcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhdXNlZCB8fCBmYWxzZTtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHBhdXNlZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGF1c2VkID0gcGF1c2VkID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8qXG4gICAgUmVuZGVyZXIgZWxlbWVudC5cbiAgICAqL1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicmVuZGVyZXJcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudF9ub2RlIHx8ICd1bmRlZmluZWQnO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICBpZiAoIW5vZGUudGFnTmFtZSkge1xuICAgICAgICAgIHRocm93IEVycm9yKFwiQ2FuIHJlbmRlciBvbmx5IG9uIGRvY3VtZW50IGVsZW1lbnRzXCIpO1xuICAgICAgICB9XG4gICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQodGhpcy5vcHRpb25zLmNhbnZhcyk7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnRfbm9kZSA9IG5vZGU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5fb25FbnRlckZyYW1lKCk7XG4gIH1cblxuICAvKlxuICAqL1xuXG5cbiAgR2FtZUNvcmUucHJvdG90eXBlLmFkZFN0YWdlID0gZnVuY3Rpb24oc3RhZ2UsIHNldEN1cnJlbnQpIHtcbiAgICBpZiAoc2V0Q3VycmVudCA9PSBudWxsKSB7XG4gICAgICBzZXRDdXJyZW50ID0gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMuX3N0YWdlc1tzdGFnZS5pZF0gPSBzdGFnZTtcbiAgICBpZiAoc2V0Q3VycmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RhZ2UgPSBzdGFnZS5pZDtcbiAgICB9XG4gIH07XG5cbiAgLypcbiAgU3dpdGNoIHBhdXNlIHN0YXRlXG4gICovXG5cblxuICBHYW1lQ29yZS5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5wYXVzZWQgPSAhdGhpcy5wYXVzZWQ7XG4gIH07XG5cbiAgLypcbiAgU2V0J3MgZnJhbWVyYXRlLiBOb3QgdXNhYmxlIGF0IHRoZSBtb21lbnQuLi5cbiAgQHBhcmFtIHtJbnR9IGZyYW1lcmF0ZVxuICBAbWV0aG9kIHNldEZyYW1lcmF0ZVxuICAqL1xuXG5cbiAgR2FtZUNvcmUucHJvdG90eXBlLnNldEZyYW1lcmF0ZSA9IGZ1bmN0aW9uKGZyYW1lcmF0ZSkge1xuICAgIGlmIChmcmFtZXJhdGUgPT0gbnVsbCkge1xuICAgICAgZnJhbWVyYXRlID0gNjA7XG4gICAgfVxuICAgIHJldHVybiB3aW5kb3cuX0ZQUyA9IGZyYW1lcmF0ZTtcbiAgfTtcblxuICAvKlxuICBTZXQgc2l6ZSBvZiBhbiBjYW52YXMgZWxlbWVudC5cbiAgQHBhcmFtIHtJbnR9IHdpZHRoXG4gIEBwYXJhbSB7SW50fSBoZWlnaHRcbiAgQG1ldGhvZCBzZXRTaXplXG4gICovXG5cblxuICBHYW1lQ29yZS5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHtcbiAgICBpZiAod2lkdGggPT0gbnVsbCkge1xuICAgICAgd2lkdGggPSA0MDA7XG4gICAgfVxuICAgIGlmIChoZWlnaHQgPT0gbnVsbCkge1xuICAgICAgaGVpZ2h0ID0gMzAwO1xuICAgIH1cbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgcmV0dXJuIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICB9O1xuXG4gIEdhbWVDb3JlLnByb3RvdHlwZS5fZnVsbFNjcmVlbl9yZXNpemVyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGdjaTtcbiAgICBnY2kgPSB0aGlzO1xuICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICByZXR1cm4gZ2NpLnNldFNpemUod2luZG93LndpZHRoLCB3aW5kb3cuaGVpZ2h0KTtcbiAgICB9O1xuICB9O1xuXG4gIC8qXG4gIENyZWF0ZXMgYSBjYW52YXMgZWxlbWVudFxuICBAbWV0aG9kIGNyZWF0ZUNhbnZhc1xuICAqL1xuXG5cbiAgR2FtZUNvcmUucHJvdG90eXBlLmNyZWF0ZUNhbnZhcyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjYW52YXM7XG4gICAgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfTtcblxuICAvKlxuICBBZGQgcmVuZGVyIHRpY2sgaG9va1xuICBcbiAgQG1ldGhvZCBhZGRSZW5kZXJUaWNrSG9va1xuICBAcGFyYW0ge1N0cmluZ30gbmFtZVxuICBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jdG9yXG4gIFxuICBAbm90ZSBSZW5kZXIgdGljayBob29rcyBjYWxscyBhZnRlciBzdGFnZSB3YXMgcmVuZGVyZWRcbiAgKi9cblxuXG4gIEdhbWVDb3JlLnByb3RvdHlwZS5hZGRSZW5kZXJUaWNrSG9vayA9IGZ1bmN0aW9uKG5hbWUsIGZ1bmN0b3IpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVuZGVyX3RpY2tfaG9va3NbbmFtZV0gPSBmdW5jdG9yO1xuICB9O1xuXG4gIC8qXG4gIFJlbW92ZXMgcmVuZGVyIHRpY2sgaG9va1xuICBAbWV0aG9kIHJlbW92ZVJlbmRlclRpY2tIb29rXG4gIEBwYXJhbSB7U3RyaW5nfSBuYW1lXG4gICovXG5cblxuICBHYW1lQ29yZS5wcm90b3R5cGUucmVtb3ZlUmVuZGVyVGlja0hvb2sgPSBmdW5jdGlvbihuYW1lKSB7XG4gICAgcmV0dXJuIGRlbGV0ZSB0aGlzLl9yZW5kZXJfdGlja19ob29rc1tuYW1lXTtcbiAgfTtcblxuICAvKlxuICBDYWxsIHdpbmRvdydzIHJlcXVlc3RBbmltYXRpb25GcmFtZS5cbiAgQG1ldGhvZCBfb25FbnRlckZyYW1lXG4gICovXG5cblxuICBHYW1lQ29yZS5wcm90b3R5cGUuX29uRW50ZXJGcmFtZSA9IGZ1bmN0aW9uKGdjaSkge1xuICAgIGlmIChnY2kgPT0gbnVsbCkge1xuICAgICAgZ2NpID0gdGhpcztcbiAgICB9XG4gICAgaWYgKCF0aGlzLnBhdXNlZCkge1xuICAgICAgZ2NpLl9yZW5kZXIoZ2NpLnN0YWdlKTtcbiAgICB9XG4gICAgcmV0dXJuIHdpbmRvdy5vbkVudGVyRnJhbWUoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZ2NpLl9vbkVudGVyRnJhbWUoZ2NpKTtcbiAgICB9KTtcbiAgfTtcblxuICBHYW1lQ29yZS5wcm90b3R5cGUuX3JlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBob29rLCBuYW1lLCBfcmVmLCBfcmVzdWx0cztcbiAgICB0aGlzLmNvbnRleHQucmVuZGVyKFt0aGlzLnN0YWdlXSk7XG4gICAgX3JlZiA9IHRoaXMuX3JlbmRlcl90aWNrX2hvb2tzO1xuICAgIF9yZXN1bHRzID0gW107XG4gICAgZm9yIChuYW1lIGluIF9yZWYpIHtcbiAgICAgIGhvb2sgPSBfcmVmW25hbWVdO1xuICAgICAgX3Jlc3VsdHMucHVzaChob29rLmNhbGwoKSk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICByZXR1cm4gR2FtZUNvcmU7XG5cbn0pKCk7XG5cbndpbmRvdy5HYW1lQ29yZSA9IHdpbmRvdy5HYW1lQ29yZSB8fCBHYW1lQ29yZTtcblxuR2FtZUNvcmUuZXhwb3J0cyA9IHtcbiAgVUk6IHJlcXVpcmUoXCIuL3VpL2V4cG9ydHNcIiksXG4gIE1hdGg6IHJlcXVpcmUoXCIuL21hdGgvZXhwb3J0c1wiKVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lQ29yZTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPWNvcmUubWFwXG4qL1xuXG59KSgpIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIENvbnRleHQyZDtcblxuQ29udGV4dDJkID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBDb250ZXh0MmQob3B0aW9ucykge1xuICAgIHRoaXMuc2V0Q2FudmFzKG9wdGlvbnMuY2FudmFzKTtcbiAgfVxuXG4gIENvbnRleHQyZC5wcm90b3R5cGUuc2V0Q2FudmFzID0gZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIENvbnRleHQyZC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jdHguY2FudmFzLndpZHRoLCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBDb250ZXh0MmQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGxheWVycykge1xuICAgIHZhciBsYXllciwgX2ksIF9sZW4sIF9yZXN1bHRzO1xuICAgIGlmIChsYXllcnMgPT0gbnVsbCkge1xuICAgICAgbGF5ZXJzID0gW107XG4gICAgfVxuICAgIHRoaXMuY2xlYXIoKTtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gbGF5ZXJzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICBsYXllciA9IGxheWVyc1tfaV07XG4gICAgICBfcmVzdWx0cy5wdXNoKGxheWVyLnJlbmRlcih0aGlzLmN0eCkpO1xuICAgIH1cbiAgICByZXR1cm4gX3Jlc3VsdHM7XG4gIH07XG5cbiAgcmV0dXJuIENvbnRleHQyZDtcblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBDb250ZXh0MmQ7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD0yZC5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgYnJvd3NlclByZWZpeCwgcHJlZml4LCB1c2VyQWdlbnQ7XG5cbnByZWZpeCA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgaWYgKGJyb3dzZXJQcmVmaXggIT09IFwiXCIpIHtcbiAgICBuYW1lID0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSk7XG4gIH1cbiAgcmV0dXJuIGJyb3dzZXJQcmVmaXggKyBuYW1lO1xufTtcblxudXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudDtcblxuYnJvd3NlclByZWZpeCA9ICh1c2VyQWdlbnQubWF0Y2goL29wZXJhL2kpICYmIFwib1wiKSB8fCAodXNlckFnZW50Lm1hdGNoKC93ZWJraXQvaSkgJiYgXCJ3ZWJraXRcIikgfHwgKHVzZXJBZ2VudC5tYXRjaCgvbXNpZS9pKSAmJiBcIm1zXCIpIHx8ICh1c2VyQWdlbnQubWF0Y2goL21vemlsbGEvaSkgJiYgXCJtb3pcIikgfHwgXCJcIjtcblxuRnVuY3Rpb24ucHJvdG90eXBlLnByb3BlcnR5ID0gZnVuY3Rpb24ocHJvcCwgZGVzYykge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMucHJvdG90eXBlLCBwcm9wLCBkZXNjKTtcbn07XG5cbmlmICh0eXBlb2Ygd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgIT09IFwiZnVuY3Rpb25cIikge1xuICBIVE1MRWxlbWVudC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKHR5cGUsIGNhbGxiYWNrLCB1c2VDYXB0dXJlKSB7XG4gICAgcmV0dXJuIGF0dGFjaEV2ZW50KFwib25cIiArIHR5cGUsIGNhbGxiYWNrKTtcbiAgfTtcbn1cblxuLypcbndpbmRvdy5vbkVudGVyRnJhbWVcbiovXG5cblxud2luZG93Lm9uRW50ZXJGcmFtZSA9IChmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgIHJldHVybiB3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIHdpbmRvdy5fRlBTKTtcbiAgfTtcbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAvKlxuICBCcm93c2VyJ3MgdXNlci1hZ2VudCBzdHJpbmdcbiAgQGF0dHJpYnV0ZSB1c2VyQWdlbnRcbiAgQHR5cGUge1N0cmluZ31cbiAgQHN0YXRpY1xuICBAcmVhZG9ubHlcbiAgKi9cblxuICB1c2VyQWdlbnQ6IHVzZXJBZ2VudCxcbiAgLypcbiAgRGV2aWNlIHN1cHBvcnRzIHRvdWNoIGV2ZW50cz9cbiAgQGF0dHJpYnV0ZSB0b3VjaFxuICBAdHlwZSB7Qm9vbGVhbn1cbiAgQHN0YXRpY1xuICBAcmVhZG9ubHlcbiAgKi9cblxuICB0b3VjaDogXCJvbnRvdWNoc3RhcnRcIiBpbiB3aW5kb3csXG4gIC8qXG4gIERldmljZSBzdXBwb3J0cyBSZXRpbmEgRGlzcGxheT9cbiAgQGF0dHJpYnV0ZSByZXRpbmFcbiAgQHR5cGUge0Jvb2xlYW59XG4gIEBzdGF0aWNcbiAgQHJlYWRvbmx5XG4gICovXG5cbiAgcmV0aW5hOiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+IDEgfHwgd2luZG93Lm1hdGNoTWVkaWEoXCIobWluLXJlc29sdXRpb246IDEuMWRwcHgpXCIpLm1hdGNoZXMsXG4gIGltYWdlU21vb3RoaW5nRW5hYmxlZDogcHJlZml4KFwiaW1hZ2VTbW9vdGhpbmdFbmFibGVkXCIpXG59O1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9c3VwcG9ydC5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgTWF0cml4MkQ6IHJlcXVpcmUoXCIuL21hdHJpeDJkXCIpLFxuICBWZWN0b3IyRDogcmVxdWlyZShcIi4vdmVjdG9yMmRcIiksXG4gIFVVSUQ6IHJlcXVpcmUoXCIuL3V1aWRcIilcbn07XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD1leHBvcnRzLm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBNYXRyaXgyRDtcblxuTWF0cml4MkQgPSAoZnVuY3Rpb24oKSB7XG4gIC8qXG4gIEJhc2VkIG9uIFtFYXNlbEpTXShodHRwczovL2dpdGh1Yi5jb20vQ3JlYXRlSlMvRWFzZWxKUy8pIE1hdHJpeDJEIGltcGxlbWVudGF0aW9uLlxuICBcbiAgQGNsYXNzIE1hdHJpeDJEXG4gIEBjb25zdHJ1Y3RvclxuICBcbiAgQHBhcmFtIHtOdW1iZXJ9IG0xMVxuICBAcGFyYW0ge051bWJlcn0gbTEyXG4gIEBwYXJhbSB7TnVtYmVyfSBtMjFcbiAgQHBhcmFtIHtOdW1iZXJ9IG0yMlxuICBAcGFyYW0ge051bWJlcn0gZHhcbiAgQHBhcmFtIHtOdW1iZXJ9IGR5XG4gICovXG5cbiAgZnVuY3Rpb24gTWF0cml4MkQobTExLCBtMTIsIG0yMSwgbTIyLCBkeCwgZHkpIHtcbiAgICBpZiAobTExICE9PSBudWxsKSB7XG4gICAgICB0aGlzLm0xMSA9IG0xMTtcbiAgICB9XG4gICAgdGhpcy5tMTIgPSBtMTIgfHwgMDtcbiAgICB0aGlzLm0yMSA9IG0yMSB8fCAwO1xuICAgIGlmIChtMjIgIT09IG51bGwpIHtcbiAgICAgIHRoaXMubTIyID0gbTIyO1xuICAgIH1cbiAgICB0aGlzLmR4ID0gZHggfHwgMDtcbiAgICB0aGlzLmR5ID0gZHkgfHwgMDtcbiAgfVxuXG4gIC8qXG4gIEdlbmVyYXRlcyBtYXRyaXggcHJvcGVydGllcyBmcm9tIHRoZSBzcGVjaWZpZWQgZGlzcGxheSBvYmplY3QgdHJhbnNmb3JtIHByb3BlcnRpZXMsIGFuZCBhcHBlbmRzIHRoZW0gd2l0aCB0aGlzIG1hdHJpeC5cbiAgRm9yIGV4YW1wbGUsIHlvdSBjYW4gdXNlIHRoaXMgdG8gZ2VuZXJhdGUgbTExIG1hdHJpeCBmcm9tIG0xMSBkaXNwbGF5IG9iamVjdDogdmFyIG10eCA9IG5ldyBNYXRyaXgyRCgpO1xuICBtdHguYXBwZW5kVHJhbnNmb3JtKG8ueCwgby55LCBvLnNjYWxlWCwgby5zY2FsZVksIG8ucm90YXRpb24pO1xuICBAbWV0aG9kIGFwcGVuZFRyYW5zZm9ybVxuICBAcGFyYW0ge051bWJlcn0geFxuICBAcGFyYW0ge051bWJlcn0geVxuICBAcGFyYW0ge051bWJlcn0gc2NhbGVYXG4gIEBwYXJhbSB7TnVtYmVyfSBzY2FsZVlcbiAgQHBhcmFtIHtOdW1iZXJ9IHJvdGF0aW9uXG4gIEBwYXJhbSB7TnVtYmVyfSBza2V3WFxuICBAcGFyYW0ge051bWJlcn0gc2tld1lcbiAgQHBhcmFtIHtOdW1iZXJ9IHBpdm90WCBPcHRpb25hbC5cbiAgQHBhcmFtIHtOdW1iZXJ9IHBpdm90WSBPcHRpb25hbC5cbiAgQHJldHVybiB7TWF0cml4MkR9IFRoaXMgbWF0cml4LiBVc2VmdWwgZm9yIGNoYWluaW5nIG1ldGhvZCBjYWxscy5cbiAgKi9cblxuXG4gIE1hdHJpeDJELnByb3RvdHlwZS5hcHBlbmRUcmFuc2Zvcm0gPSBmdW5jdGlvbih4LCB5LCBzY2FsZVgsIHNjYWxlWSwgcm90YXRpb24sIHNrZXdYLCBza2V3WSwgcGl2b3RYLCBwaXZvdFkpIHtcbiAgICB2YXIgY29zLCByLCBzaW47XG4gICAgY29zID0gdm9pZCAwO1xuICAgIHNpbiA9IHZvaWQgMDtcbiAgICByID0gdm9pZCAwO1xuICAgIGlmIChyb3RhdGlvbiAlIDM2MCkge1xuICAgICAgciA9IHJvdGF0aW9uICogTWF0cml4MkQuREVHX1RPX1JBRDtcbiAgICAgIGNvcyA9IE1hdGguY29zKHIpO1xuICAgICAgc2luID0gTWF0aC5zaW4ocik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvcyA9IDE7XG4gICAgICBzaW4gPSAwO1xuICAgIH1cbiAgICBpZiAoc2tld1ggfHwgc2tld1kpIHtcbiAgICAgIHNrZXdYICo9IE1hdHJpeDJELkRFR19UT19SQUQ7XG4gICAgICBza2V3WSAqPSBNYXRyaXgyRC5ERUdfVE9fUkFEO1xuICAgICAgdGhpcy5hcHBlbmQoTWF0aC5jb3Moc2tld1kpLCBNYXRoLnNpbihza2V3WSksIC1NYXRoLnNpbihza2V3WCksIE1hdGguY29zKHNrZXdYKSwgeCwgeSk7XG4gICAgICB0aGlzLmFwcGVuZChjb3MgKiBzY2FsZVgsIHNpbiAqIHNjYWxlWCwgLXNpbiAqIHNjYWxlWSwgY29zICogc2NhbGVZLCAwLCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hcHBlbmQoY29zICogc2NhbGVYLCBzaW4gKiBzY2FsZVgsIC1zaW4gKiBzY2FsZVksIGNvcyAqIHNjYWxlWSwgeCwgeSk7XG4gICAgfVxuICAgIGlmIChwaXZvdFggfHwgcGl2b3RZKSB7XG4gICAgICB0aGlzLmR4IC09IHBpdm90WCAqIHRoaXMubTExICsgcGl2b3RZICogdGhpcy5tMjE7XG4gICAgICB0aGlzLmR5IC09IHBpdm90WCAqIHRoaXMubTEyICsgcGl2b3RZICogdGhpcy5tMjI7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qXG4gIEFwcGVuZHMgdGhlIHNwZWNpZmllZCBtYXRyaXggcHJvcGVydGllcyB3aXRoIHRoaXMgbWF0cml4LiBBbGwgcGFyYW1ldGVycyBhcmUgcmVxdWlyZWQuXG4gIEBtZXRob2QgYXBwZW5kXG4gIEBwYXJhbSB7TnVtYmVyfSBtMTFcbiAgQHBhcmFtIHtOdW1iZXJ9IG0xMlxuICBAcGFyYW0ge051bWJlcn0gbTIxXG4gIEBwYXJhbSB7TnVtYmVyfSBtMjJcbiAgQHBhcmFtIHtOdW1iZXJ9IGR4XG4gIEBwYXJhbSB7TnVtYmVyfSBkeVxuICBAcmV0dXJuIHtNYXRyaXgyRH0gVGhpcyBtYXRyaXguIFVzZWZ1bCBmb3IgY2hhaW5pbmcgbWV0aG9kIGNhbGxzLlxuICAqL1xuXG5cbiAgTWF0cml4MkQucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uKG0xMSwgbTEyLCBtMjEsIG0yMiwgZHgsIGR5KSB7XG4gICAgdmFyIGExLCBiMSwgYzEsIGQxO1xuICAgIGExID0gdGhpcy5tMTE7XG4gICAgYjEgPSB0aGlzLm0xMjtcbiAgICBjMSA9IHRoaXMubTIxO1xuICAgIGQxID0gdGhpcy5tMjI7XG4gICAgdGhpcy5tMTEgPSBtMTEgKiBhMSArIG0xMiAqIGMxO1xuICAgIHRoaXMubTEyID0gbTExICogYjEgKyBtMTIgKiBkMTtcbiAgICB0aGlzLm0yMSA9IG0yMSAqIGExICsgbTIyICogYzE7XG4gICAgdGhpcy5tMjIgPSBtMjEgKiBiMSArIG0yMiAqIGQxO1xuICAgIHRoaXMuZHggPSBkeCAqIGExICsgZHkgKiBjMSArIHRoaXMuZHg7XG4gICAgdGhpcy5keSA9IGR4ICogYjEgKyBkeSAqIGQxICsgdGhpcy5keTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKlxuICBJbnZlcnRzIHRoZSBtYXRyaXgsIGNhdXNpbmcgaXQgdG8gcGVyZm9ybSB0aGUgb3Bwb3NpdGUgdHJhbnNmb3JtYXRpb24uXG4gIEBtZXRob2QgaW52ZXJ0XG4gIEByZXR1cm4ge01hdHJpeDJEfSB0aGlzXG4gICovXG5cblxuICBNYXRyaXgyRC5wcm90b3R5cGUuaW52ZXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGExLCBiMSwgYzEsIGQxLCBuLCB0eDE7XG4gICAgYTEgPSB0aGlzLm0xMTtcbiAgICBiMSA9IHRoaXMubTEyO1xuICAgIGMxID0gdGhpcy5tMjE7XG4gICAgZDEgPSB0aGlzLm0yMjtcbiAgICB0eDEgPSB0aGlzLmR4O1xuICAgIG4gPSBhMSAqIGQxIC0gYjEgKiBjMTtcbiAgICB0aGlzLm0xMSA9IGQxIC8gbjtcbiAgICB0aGlzLm0xMiA9IC1iMSAvIG47XG4gICAgdGhpcy5tMjEgPSAtYzEgLyBuO1xuICAgIHRoaXMubTIyID0gYTEgLyBuO1xuICAgIHRoaXMuZHggPSAoYzEgKiB0aGlzLmR5IC0gZDEgKiB0eDEpIC8gbjtcbiAgICB0aGlzLmR5ID0gLShhMSAqIHRoaXMuZHkgLSBiMSAqIHR4MSkgLyBuO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qXG4gIENsb25lIE1hdHJpeDJEIGluc3RhbmNlXG4gIEByZXR1cm4ge01hdHJpeDJEfVxuICAqL1xuXG5cbiAgTWF0cml4MkQucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgyRCh0aGlzLm0xMSwgdGhpcy5tMTIsIHRoaXMubTIxLCB0aGlzLm0yMiwgdGhpcy5keCwgdGhpcy5keSk7XG4gIH07XG5cbiAgLypcbiAgUmVzZXQgbWF0cml4IHRvIGl0J3MgaWRlbnRpdHlcbiAgQHJldHVybiB7TWF0cml4MkR9IHRoaXNcbiAgKi9cblxuXG4gIE1hdHJpeDJELnByb3RvdHlwZS5pZGVudGl0eSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubTExID0gdGhpcy5tMjIgPSAxO1xuICAgIHRoaXMubTEyID0gdGhpcy5tMjEgPSB0aGlzLmR4ID0gdGhpcy5keSA9IDA7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyogICAgICAgICAgIFxuICBNdWx0aXBsaWVyIGZvciBjb252ZXJ0aW5nIGRlZ3JlZXMgdG8gcmFkaWFucy4gVXNlZCBpbnRlcm5hbGx5IGJ5IE1hdHJpeDJELlxuICBcbiAgQGF0dHJpYnV0ZSBERUdfVE9fUkFEXG4gIEBzdGF0aWNcbiAgQHJlYWRvbmx5XG4gIEByZXR1cm4ge051bWJlcn1cbiAgKi9cblxuXG4gIE1hdHJpeDJELkRFR19UT19SQUQgPSBNYXRoLlBJIC8gMTgwO1xuXG4gIE1hdHJpeDJELmlkZW50aXR5ID0gbmV3IE1hdHJpeDJEKDEsIDAsIDAsIDEsIDAsIDApO1xuXG4gIHJldHVybiBNYXRyaXgyRDtcblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBNYXRyaXgyRDtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPW1hdHJpeDJkLm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBVVUlEO1xuXG5VVUlEID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBVVUlEKCkge31cblxuICAvKlxuICBAbWV0aG9kIGdlbmVyYXRlVW5pcXVlSWRcbiAgQHJldHVybiB7U3RyaW5nfVxuICAqL1xuXG5cbiAgVVVJRC5nZW5lcmF0ZVVuaXF1ZUlkID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFwiZ2MtXCIgKyB0aGlzLnV1aWQoKTtcbiAgfTtcblxuICAvKlxuICBAbWV0aG9kIHV1aWRcbiAgQHJldHVybiB7U3RyaW5nfVxuICAqL1xuXG5cbiAgVVVJRC51dWlkID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24oYykge1xuICAgICAgdmFyIHIsIHY7XG4gICAgICByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMDtcbiAgICAgIHYgPSBjID09PSAneCcgPyByIDogciAmIDB4MyB8IDB4ODtcbiAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gVVVJRDtcblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBVVUlEO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9dXVpZC5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgVmVjdG9yMmQ7XG5cblZlY3RvcjJkID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBWZWN0b3IyZCh4LCB5KSB7XG4gICAgdGhpcy54ID0geCAhPSBudWxsID8geCA6IDA7XG4gICAgdGhpcy55ID0geSAhPSBudWxsID8geSA6IDA7XG4gICAgLypcbiAgICBHZXQgdGhlIG1hZ25pdHVkZSBvZiB0aGlzIHZlY3RvclxuICAgIEBhdHRyaWJ1dGUgbGVuZ3RoXG4gICAgQHJlYWRvbmx5XG4gICAgKi9cblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImxlbmd0aFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KCh0aGlzLnggKiB0aGlzLngpICsgKHRoaXMueSAqIHRoaXMueSkpO1xuICAgICAgfSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIC8qXG4gICAgR2V0IHRoaXMgdmVjdG9yIHdpdGggYSBtYWduaXR1ZGUgb2YgMS5cbiAgICBAYXR0cmlidXRlIG5vcm1hbGl6ZWRcbiAgICBAcmVhZG9ubHlcbiAgICAqL1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibm9ybWFsaXplZFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbWFnbml0dWRlO1xuICAgICAgICBtYWduaXR1ZGUgPSB0aGlzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyZCh0aGlzLnggLyBtYWduaXR1ZGUsIHRoaXMueSAvIG1hZ25pdHVkZSk7XG4gICAgICB9LFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICAvKlxuICBAbWV0aG9kIHNldFxuICBAcGFyYW0ge051bWJlcn0geFxuICBAcGFyYW0ge051bWJlcn0geVxuICBAcmV0dXJuIHtWZWN0b3IyZH1cbiAgKi9cblxuXG4gIFZlY3RvcjJkLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xuICB9O1xuXG4gIC8qXG4gIEBtZXRob2Qgc3VtXG4gIEBwYXJhbSB7VmVjdG9yMmR9IHZlY3RvcjJkXG4gIEByZXR1cm4ge1ZlY3RvcjJkfVxuICAqL1xuXG5cbiAgVmVjdG9yMmQucHJvdG90eXBlLnN1YnRyYWN0ID0gZnVuY3Rpb24odmVjdG9yMmQpIHtcbiAgICB0aGlzLnggLT0gdmVjdG9yMmQueDtcbiAgICByZXR1cm4gdGhpcy55IC09IHZlY3RvcjJkLnk7XG4gIH07XG5cbiAgLypcbiAgQG1ldGhvZCBzdW1cbiAgQHBhcmFtIHtWZWN0b3IyZH0gdmVjdG9yMmRcbiAgQHJldHVybiB7VmVjdG9yMmR9XG4gICovXG5cblxuICBWZWN0b3IyZC5wcm90b3R5cGUuc3VtID0gZnVuY3Rpb24odmVjdG9yMmQpIHtcbiAgICB0aGlzLnggKz0gdmVjdG9yMmQueDtcbiAgICByZXR1cm4gdGhpcy55ICs9IHZlY3RvcjJkLnk7XG4gIH07XG5cbiAgLypcbiAgQG1ldGhvZCBzY2FsZVxuICBAcGFyYW0ge051bWJlcn0geCAob3IgeCB5KVxuICBAcGFyYW0ge051bWJlcn0geVxuICBAcmV0dXJuIHtWZWN0b3IyZH1cbiAgKi9cblxuXG4gIFZlY3RvcjJkLnByb3RvdHlwZS5zY2FsZSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICB0aGlzLnggKj0geDtcbiAgICByZXR1cm4gdGhpcy55ICo9IHkgfHwgeDtcbiAgfTtcblxuICAvKlxuICBAbWV0aG9kIGNsb25lXG4gIEByZXR1cm4ge1ZlY3RvcjJkfVxuICAqL1xuXG5cbiAgVmVjdG9yMmQucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBWZWN0b3IyZCh0aGlzLngsIHRoaXMueSk7XG4gIH07XG5cbiAgLypcbiAgUmV0dXJuIHVuaXQgdmVjdG9yXG4gIEByZXR1cm4ge1ZlY3RvcjJkfVxuICAqL1xuXG5cbiAgVmVjdG9yMmQucHJvdG90eXBlLnVuaXQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFZlY3RvcjJkKE1hdGguY29zKHRoaXMueCksIE1hdGguc2luKHRoaXMueSkpO1xuICB9O1xuXG4gIC8qXG4gIE5vcm1hbGl6ZSB0aGlzIHZlY3RvclxuICBAcmV0dXJuIHtWZWN0b3IyZH1cbiAgKi9cblxuXG4gIFZlY3RvcjJkLnByb3RvdHlwZS5ub3JtYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9ybWFsO1xuICAgIG5vcm1hbCA9IHRoaXMubm9ybWFsaXplZDtcbiAgICB0aGlzLnggPSBub3JtYWwueDtcbiAgICByZXR1cm4gdGhpcy55ID0gbm9ybWFsLnk7XG4gIH07XG5cbiAgLypcbiAgR2V0IHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHRoaXMgdmVjdG9yIGFuZCB0aGUgYXJndW1lbnQgdmVjdG9yXG4gIEBwYXJhbSB7VmVjdG9yMmR9IHZlY3RvclxuICBAcmV0dXJuIHtOdW1iZXJ9XG4gICovXG5cblxuICBWZWN0b3IyZC5kaXN0YW5jZSA9IGZ1bmN0aW9uKHYxLCB2Mikge1xuICAgIHZhciB4ZGlmZiwgeWRpZmY7XG4gICAgeGRpZmYgPSB2MS54IC0gdjIueDtcbiAgICB5ZGlmZiA9IHYxLnkgLSB2Mi55O1xuICAgIHJldHVybiBNYXRoLnNxcnQoeGRpZmYgKiB4ZGlmZiArIHlkaWZmICogeWRpZmYpO1xuICB9O1xuXG4gIC8qXG4gIEBtZXRob2QgdG9TdHJpbmdcbiAgQHJldHVybiB7U3RyaW5nfVxuICAqL1xuXG5cbiAgVmVjdG9yMmQucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFwiIzxWZWN0b3IyZCBAeD1cIiArIHRoaXMueCArIFwiLCBAeT1cIiArIHRoaXMueSArIFwiPlwiO1xuICB9O1xuXG4gIFZlY3RvcjJkLkxFRlQgPSBuZXcgVmVjdG9yMmQoLTEsIDApO1xuXG4gIFZlY3RvcjJkLlJJR0hUID0gbmV3IFZlY3RvcjJkKDEsIDApO1xuXG4gIFZlY3RvcjJkLlRPUCA9IG5ldyBWZWN0b3IyZCgwLCAtMSk7XG5cbiAgVmVjdG9yMmQuQk9UVE9NID0gbmV3IFZlY3RvcjJkKDAsIDEpO1xuXG4gIHJldHVybiBWZWN0b3IyZDtcblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBWZWN0b3IyZDtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPXZlY3RvcjJkLm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBDb250YWluZXIsIFdpZGdldCxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5XaWRnZXQgPSByZXF1aXJlKFwiLi93aWRnZXRcIik7XG5cbkNvbnRhaW5lciA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKENvbnRhaW5lciwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBDb250YWluZXIob3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9XG4gICAgQ29udGFpbmVyLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICAgIHRoaXMuY2hpbGRyZW4gPSB7fTtcbiAgfVxuXG4gIENvbnRhaW5lci5wcm90b3R5cGUuYWRkQ2hpbGQgPSBmdW5jdGlvbihjaGlsZCkge1xuICAgIGlmIChjaGlsZC5wYXJlbnQgPT09ICF0aGlzKSB7XG4gICAgICByZXR1cm4gY2hpbGQucGFyZW50ID0gdGhpcztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5bY2hpbGQuaWRdID0gY2hpbGQ7XG4gICAgfVxuICB9O1xuXG4gIENvbnRhaW5lci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oY3R4KSB7XG4gICAgdmFyIGNoaWxkLCBjaWQsIF9yZWYsIF9yZXN1bHRzO1xuICAgIENvbnRhaW5lci5fX3N1cGVyX18ucmVuZGVyLmNhbGwodGhpcywgY3R4KTtcbiAgICBfcmVmID0gdGhpcy5jaGlsZHJlbjtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoY2lkIGluIF9yZWYpIHtcbiAgICAgIGNoaWxkID0gX3JlZltjaWRdO1xuICAgICAgX3Jlc3VsdHMucHVzaChjaGlsZC5yZW5kZXIoY3R4KSk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICByZXR1cm4gQ29udGFpbmVyO1xuXG59KShXaWRnZXQpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbnRhaW5lcjtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPWNvbnRhaW5lci5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgV2lkZ2V0OiByZXF1aXJlKFwiLi93aWRnZXRcIiksXG4gIFN0YWdlOiByZXF1aXJlKFwiLi9zdGFnZVwiKSxcbiAgQ29udGFpbmVyOiByZXF1aXJlKFwiLi9jb250YWluZXJcIiksXG4gIFRleHQ6IHJlcXVpcmUoXCIuL3RleHRcIiksXG4gIGdlb21ldHJ5OiByZXF1aXJlKFwiLi9nZW9tZXRyeS9leHBvcnRzXCIpXG59O1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9ZXhwb3J0cy5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgQ2lyY2xlLCBXaWRnZXQsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuV2lkZ2V0ID0gcmVxdWlyZShcIi4uL3dpZGdldFwiKTtcblxuQ2lyY2xlID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoQ2lyY2xlLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIENpcmNsZShvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICBDaXJjbGUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gIH1cblxuICByZXR1cm4gQ2lyY2xlO1xuXG59KShXaWRnZXQpO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9Y2lyY2xlLm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbm1vZHVsZS5leHBvcnRzID0ge1xuICBDaXJjbGU6IHJlcXVpcmUoXCIuL2NpcmNsZVwiKSxcbiAgUmVjdDogcmVxdWlyZShcIi4vcmVjdFwiKVxufTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPWV4cG9ydHMubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIFJlY3QsIFdpZGdldCxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5XaWRnZXQgPSByZXF1aXJlKFwiLi4vd2lkZ2V0XCIpO1xuXG5SZWN0ID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoUmVjdCwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBSZWN0KG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIFJlY3QuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gIH1cblxuICByZXR1cm4gUmVjdDtcblxufSkoV2lkZ2V0KTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPXJlY3QubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIFN0YWdlLCBjb250YWluZXIsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuY29udGFpbmVyID0gcmVxdWlyZShcIi4uL3VpL2NvbnRhaW5lclwiKTtcblxuU3RhZ2UgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhTdGFnZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBTdGFnZShvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICBTdGFnZS5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB0aGlzLnggPSAwO1xuICAgIHRoaXMueSA9IDA7XG4gIH1cblxuICBTdGFnZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oY3R4KSB7XG4gICAgdGhpcy53aWR0aCA9IGN0eC5jYW52YXMud2lkdGg7XG4gICAgdGhpcy5oZWlnaHQgPSBjdHguY2FudmFzLmhlaWdodDtcbiAgICByZXR1cm4gU3RhZ2UuX19zdXBlcl9fLnJlbmRlci5jYWxsKHRoaXMsIGN0eCk7XG4gIH07XG5cbiAgcmV0dXJuIFN0YWdlO1xuXG59KShjb250YWluZXIpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFN0YWdlO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9c3RhZ2UubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIEJBU0VMSU5FLCBERUZBVUxUX0FMSUdOLCBERUZBVUxUX0JBU0VMSU5FLCBERUZBVUxUX0NPTE9SLCBERUZBVUxUX0ZPTlQsIFRleHQsIFdpZGdldCxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5XaWRnZXQgPSByZXF1aXJlKFwiLi93aWRnZXRcIik7XG5cbi8qXG5PYmplY3QuZGVmaW5lUHJvcGVydHkgdGhpcywgQkFTRUxJTkVcbkBzdGF0aWNcbiovXG5cblxuQkFTRUxJTkUgPSB7XG4gIC8qXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB0aGlzLCBCQVNFTElORS5UT1BcbiAgQHR5cGUge1N0cmluZ31cbiAgQHN0YXRpY1xuICAqL1xuXG4gIFRPUDogXCJ0b3BcIixcbiAgLypcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoaXMsIEJBU0VMSU5FLkhBTkdJTkdcbiAgQHR5cGUge1N0cmluZ31cbiAgQHN0YXRpY1xuICAqL1xuXG4gIEhBTkdJTkc6IFwiaGFuZ2luZ1wiLFxuICAvKlxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkgdGhpcywgQkFTRUxJTkUuTUlERExFXG4gIEB0eXBlIHtTdHJpbmd9XG4gIEBzdGF0aWNcbiAgKi9cblxuICBNSURETEU6IFwibWlkZGxlXCIsXG4gIC8qXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB0aGlzLCBCQVNFTElORS5BTFBIQUJFVElDXG4gIEB0eXBlIHtTdHJpbmd9XG4gIEBzdGF0aWNcbiAgKi9cblxuICBBTFBIQUJFVElDOiBcImFscGhhYmV0aWNcIixcbiAgLypcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoaXMsIEJBU0VMSU5FLklERU9HUkFQSElDXG4gIEB0eXBlIHtTdHJpbmd9XG4gIEBzdGF0aWNcbiAgKi9cblxuICBJREVPR1JBUEhJQzogXCJpZGVvZ3JhcGhpY1wiLFxuICAvKlxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkgdGhpcywgQkFTRUxJTkUuQk9UVE9NXG4gIEB0eXBlIHtTdHJpbmd9XG4gIEBzdGF0aWNcbiAgKi9cblxuICBCT1RUT006IFwiYm90dG9tXCJcbn07XG5cbkRFRkFVTFRfRk9OVCA9IFwiTm9ybWFsIDEycHggVmVyZGFuYVwiO1xuXG5ERUZBVUxUX0NPTE9SID0gXCIjMDAwMDAwXCI7XG5cbkRFRkFVTFRfQUxJR04gPSBcImxlZnRcIjtcblxuREVGQVVMVF9CQVNFTElORSA9IEJBU0VMSU5FLlRPUDtcblxuVGV4dCA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKFRleHQsIF9zdXBlcik7XG5cbiAgLypcbiAgQGNsYXNzIFRleHRcbiAgQGV4dGVuZHMgRGlzcGxheU9iamVjdFxuICBcbiAgQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgYW55IGF0dHJpYnV0ZSBtYXkgYmUgaW5pdGlhbGl6ZWQgYnkgb3B0aW9uXG4gIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy50ZXh0XSBkZWZhdWx0IC0gXCJcIlxuICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuZm9udF0gZGVmYXVsdCAtIFwiTm9ybWFsIDEycHggVmVyZGFuYVwiXG4gIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5hbGlnbl0gZGVmYXVsdCAtIFwibGVmdFwiXG4gIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5iYXNlbGluZV0gZGVmYXVsdCAtIEpveS5UZXh0LkJBU0VMSU5FLlRPUFxuICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuY29sb3JdIGRlZmF1bHQgLSAjMDAwMDAwXG4gIFxuICBAY29uc3RydWN0b3JcbiAgKi9cblxuXG4gIGZ1bmN0aW9uIFRleHQob3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9XG4gICAgVGV4dC5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICAvKlxuICAgIFRleHQgdG8gYmUgZGlzcGxheWVkXG4gICAgQGF0dHJpYnV0ZSB0ZXh0XG4gICAgQGRlZmF1bHQgXCJcIlxuICAgIEB0eXBlIHtTdHJpbmd9XG4gICAgKi9cblxuICAgIHRoaXMudGV4dCA9IG9wdGlvbnMudGV4dCB8fCBcIlwiO1xuICAgIC8qXG4gICAgRm9udCBmYW1pbHkgYW5kIHNpemVcbiAgICBAYXR0cmlidXRlIGZvbnRcbiAgICBAZGVmYXVsdCBcIk5vcm1hbCAxMnB4IFZlcmRhbmFcIlxuICAgIEB0eXBlIHtTdHJpbmd9XG4gICAgKi9cblxuICAgIHRoaXMuZm9udCA9IG9wdGlvbnMuZm9udCB8fCBERUZBVUxUX0ZPTlQ7XG4gICAgLypcbiAgICBUZXh0IGhvcml6b250YWwgYWxpZ25tZW50XG4gICAgQGF0dHJpYnV0ZSBhbGlnblxuICAgIEBkZWZhdWx0IFwibGVmdFwiXG4gICAgQHR5cGUge1N0cmluZ31cbiAgICAqL1xuXG4gICAgdGhpcy5hbGlnbiA9IG9wdGlvbnMuYWxpZ24gfHwgREVGQVVMVF9BTElHTjtcbiAgICAvKlxuICAgIFRleHQgdmVydGljYWwgYmFzZWxpbmVcbiAgICBAYXR0cmlidXRlIGJhc2VsaW5lXG4gICAgQGRlZmF1bHQgSm95LlRleHQuQkFTRUxJTkUuVE9QXG4gICAgQHR5cGUge1N0cmluZ31cbiAgICAqL1xuXG4gICAgdGhpcy5iYXNlbGluZSA9IG9wdGlvbnMuYmFzZWxpbmUgfHwgREVGQVVMVF9CQVNFTElORTtcbiAgICAvKlxuICAgIENvbG9yIG9mIHRoZSB0ZXh0XG4gICAgQGF0dHJpYnV0ZSBjb2xvclxuICAgIEBkZWZhdWx0IFwiIzAwMDAwMFwiXG4gICAgQHR5cGUge1N0cmluZywgQ29sb3J9XG4gICAgKi9cblxuICAgIHRoaXMuX2NvbG9yID0gb3B0aW9ucy5jb2xvciB8fCBERUZBVUxUX0NPTE9SO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbG9yXCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb2xvcjtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKGNvbG9yKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb2xvciA9IGNvbG9yLnRvU3RyaW5nKCk7XG4gICAgICB9LFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgaWYgKG9wdGlvbnMuc3Ryb2tlKSB7XG4gICAgICB0aGlzLnVzZVN0cm9rZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVzZUZpbGwoKTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwid2lkdGhcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuX19tZWFzdXJlKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX19tZWFzdXJlLndpZHRoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaGVpZ2h0XCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLl9fbWVhc3VyZSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLl9fbWVhc3VyZS5oZWlnaHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gIEBtZXRob2QgdXNlU3Ryb2tlXG4gICovXG5cblxuICBUZXh0LnByb3RvdHlwZS51c2VTdHJva2UgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnN0cm9rZSA9IHRydWU7XG4gICAgdGhpcy5maWxsTWV0aG9kID0gXCJzdHJva2VUZXh0XCI7XG4gICAgcmV0dXJuIHRoaXMuc3R5bGVNZXRob2QgPSBcInN0cm9rZVN0eWxlXCI7XG4gIH07XG5cbiAgLypcbiAgQG1ldGhvZCB1c2VGaWxsXG4gICovXG5cblxuICBUZXh0LnByb3RvdHlwZS51c2VGaWxsID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zdHJva2UgPSBmYWxzZTtcbiAgICB0aGlzLmZpbGxNZXRob2QgPSBcImZpbGxUZXh0XCI7XG4gICAgcmV0dXJuIHRoaXMuc3R5bGVNZXRob2QgPSBcImZpbGxTdHlsZVwiO1xuICB9O1xuXG4gIFRleHQucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbihjdHgpIHtcbiAgICBjdHguZm9udCA9IHRoaXMuZm9udDtcbiAgICBjdHgudGV4dEFsaWduID0gdGhpcy5hbGlnbjtcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gdGhpcy5iYXNlbGluZTtcbiAgICBjdHhbdGhpcy5zdHlsZU1ldGhvZF0gPSB0aGlzLmNvbG9yO1xuICAgIGN0eFt0aGlzLmZpbGxNZXRob2RdKHRoaXMudGV4dCwgMCwgMCk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TWVhc3VyZShjdHgpO1xuICB9O1xuXG4gIC8qXG4gIEBtZXRob2QgZ2V0TWVhc3VyZVxuICBAcmV0dXJuIHtUZXh0TWV0cmljc30gdGV4dCBtZXRyaWNzXG4gICovXG5cblxuICBUZXh0LnByb3RvdHlwZS5nZXRNZWFzdXJlID0gZnVuY3Rpb24oY3R4KSB7XG4gICAgdmFyIG07XG4gICAgdGhpcy5fX21lYXN1cmUgPSB7fTtcbiAgICBtID0gVGV4dC5NZWFzdXJlVGV4dCh0aGlzLnRleHQsIHRoaXMuZm9udCk7XG4gICAgdGhpcy5fX21lYXN1cmUud2lkdGggPSBtWzBdO1xuICAgIHJldHVybiB0aGlzLl9fbWVhc3VyZS5oZWlnaHQgPSBtWzFdO1xuICB9O1xuXG4gIFRleHQuQkFTRUxJTkUgPSBCQVNFTElORTtcblxuICBUZXh0Lk1lYXN1cmVUZXh0ID0gZnVuY3Rpb24odGV4dCwgZm9udCkge1xuICAgIHZhciBkaXYsIHNpemUsIHN0cjtcbiAgICBzdHIgPSB0ZXh0ICsgXCI6XCIgKyBmb250O1xuICAgIGlmICh0eXBlb2YgdGhpcy5fX21lYXN1cmV0ZXh0X2NhY2hlX18gPT09IFwib2JqZWN0XCIgJiYgdGhpcy5fX21lYXN1cmV0ZXh0X2NhY2hlX19bc3RyXSkge1xuICAgICAgcmV0dXJuIHRoaXMuX19tZWFzdXJldGV4dF9jYWNoZV9fW3N0cl07XG4gICAgfVxuICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJESVZcIik7XG4gICAgZGl2LmlubmVySFRNTCA9IHRleHQ7XG4gICAgZGl2LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIGRpdi5zdHlsZS50b3AgPSBcIi0xMDBweFwiO1xuICAgIGRpdi5zdHlsZS5sZWZ0ID0gXCItMTAwcHhcIjtcbiAgICBkaXYuc3R5bGUuZm9udCA9IGZvbnQ7XG4gICAgY29uc29sZS5sb2coZGl2LnN0eWxlLmZvbnRGYW1pbHksIGRpdi5zdHlsZS5mb250V2VpZ2h0LCBkaXYuc3R5bGUuZm9udFNpemUpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICBzaXplID0gW2Rpdi5vZmZzZXRXaWR0aCwgZGl2Lm9mZnNldEhlaWdodF07XG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkaXYpO1xuICAgIGlmICh0eXBlb2YgdGhpcy5fX21lYXN1cmV0ZXh0X2NhY2hlX18gIT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHRoaXMuX19tZWFzdXJldGV4dF9jYWNoZV9fID0ge307XG4gICAgfVxuICAgIHRoaXMuX19tZWFzdXJldGV4dF9jYWNoZV9fW3N0cl0gPSBzaXplO1xuICAgIHJldHVybiBzaXplO1xuICB9O1xuXG4gIHJldHVybiBUZXh0O1xuXG59KShXaWRnZXQpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRleHQ7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD10ZXh0Lm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBDb2xvciwgQ29yZSwgTWF0cml4MmQsIFN1cHBvcnQsIFVVSUQsIFZlY3RvcjJkLCBXaWRnZXQ7XG5cbkNvcmUgPSByZXF1aXJlKFwiLi4vY29yZVwiKTtcblxuVVVJRCA9IHJlcXVpcmUoXCIuLi9tYXRoL3V1aWRcIik7XG5cblZlY3RvcjJkID0gcmVxdWlyZShcIi4uL21hdGgvdmVjdG9yMmRcIik7XG5cbk1hdHJpeDJkID0gcmVxdWlyZShcIi4uL21hdGgvbWF0cml4MmRcIik7XG5cblN1cHBvcnQgPSByZXF1aXJlKFwiLi4vY29yZS9zdXBwb3J0XCIpO1xuXG5Db2xvciA9IHJlcXVpcmUoXCIuLi91dGlscy9jb2xvclwiKTtcblxuLypcbkJhc2UgcmVuZGVyYWJsZSBlbGVtZW50XG4qL1xuXG5cbldpZGdldCA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gV2lkZ2V0KG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIHRoaXMuaWQgPSBVVUlELmdlbmVyYXRlVW5pcXVlSWQoKTtcbiAgICAvKlxuICAgIEBhdHRyaWJ1dGUgcGl2b3RcbiAgICBAdHlwZSB7VmVjdG9yMmR9XG4gICAgQGRlZmF1bHQgMCwwXG4gICAgKi9cblxuICAgIHRoaXMucGl2b3QgPSBvcHRpb25zLnBpdm90IHx8IG5ldyBWZWN0b3IyZChvcHRpb25zLnBpdm90WCB8fCAwLCBvcHRpb25zLnBpdm90WSB8fCAwKTtcbiAgICAvKlxuICAgIEBhdHRyaWJ1dGUgc2tld1hcbiAgICBAdHlwZSB7TnVtYmVyfVxuICAgIEBkZWZhdWx0IDBcbiAgICAqL1xuXG4gICAgdGhpcy5za2V3ID0gb3B0aW9ucy5za2V3IHx8IG5ldyBWZWN0b3IyZChvcHRpb25zLnNrZXdYIHx8IDAsIG9wdGlvbnMuc2tld1kgfHwgMCk7XG4gICAgLypcbiAgICBAYXR0cmlidXRlIHNjYWxlXG4gICAgQHR5cGUge1ZlY3RvcjJkfVxuICAgIEBkZWZhdWx0IDEsMVxuICAgICovXG5cbiAgICB0aGlzLnNjYWxlID0gb3B0aW9ucy5zY2FsZSB8fCBuZXcgVmVjdG9yMmQob3B0aW9ucy5zY2FsZVggfHwgMSwgb3B0aW9ucy5zY2FsZVkgfHwgMSk7XG4gICAgLypcbiAgICBAYXR0cmlidXRlIGFscGhhXG4gICAgQHR5cGUge051bWJlcn1cbiAgICBAZGVmYXVsdCAxXG4gICAgKi9cblxuICAgIHRoaXMuYWxwaGEgPSAodHlwZW9mIG9wdGlvbnMuYWxwaGEgPT09IFwidW5kZWZpbmVkXCIgPyAxIDogb3B0aW9ucy5hbHBoYSk7XG4gICAgLypcbiAgICBAYXR0cmlidXRlIHJvdGF0aW9uXG4gICAgQHR5cGUge051bWJlcn1cbiAgICBAZGVmYXVsdCAwXG4gICAgKi9cblxuICAgIHRoaXMucm90YXRpb24gPSBvcHRpb25zLnJvdGF0aW9uIHx8IDA7XG4gICAgLypcbiAgICBAYXR0cmlidXRlIHNtb290aFxuICAgIEB0eXBlIHtCb29sZWFufVxuICAgIEBkZWZhdWx0IGZhbHNlXG4gICAgKi9cblxuICAgIHRoaXMuc21vb3RoID0gKHR5cGVvZiBvcHRpb25zLnNtb290aCA9PT0gXCJ1bmRlZmluZWRcIiA/IHRydWUgOiBvcHRpb25zLnNtb290aCk7XG4gICAgdGhpcy5fbWF0cml4ID0gTWF0cml4MmQuaWRlbnRpdHkuY2xvbmUoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJwb3NpdGlvblwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3Bvc2l0aW9uKSB7XG4gICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBuZXcgVmVjdG9yMmQoMCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24odmVjdG9yKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbiA9IHZlY3Rvci5jbG9uZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInhcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb24ueCB8fCAwO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24oeCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbi54ID0geDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy54KSB7XG4gICAgICB0aGlzLnggPSBvcHRpb25zLng7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInlcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb24ueSB8fCAwO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24oeSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbi55ID0geTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy55KSB7XG4gICAgICB0aGlzLnkgPSBvcHRpb25zLnk7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIndpZHRoXCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl93aWR0aCB8fCAxMDtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoID0gdztcbiAgICAgIH0sXG4gICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy53aWR0aCkge1xuICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImhlaWdodFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0IHx8IDEwO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24oaCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0ID0gaDtcbiAgICAgIH0sXG4gICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy5oZWlnaHQpIHtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInBhcmVudFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50IHx8ICd1bmRlZmluZWQnO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24ocGFyZW50KSB7XG4gICAgICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudC5hZGRDaGlsZCh0aGlzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy5wYXJlbnQpIHtcbiAgICAgIHRoaXMucGFyZW50ID0gb3B0aW9ucy5wYXJlbnQ7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRyYXdCb3VuZGluZ0JveFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYm91bmRpbmdfYm94IHx8IGZhbHNlO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24oYm9vb2wpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JvdW5kaW5nX2JveCA9IGJvb29sIHx8IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChvcHRpb25zLmJib3gpIHtcbiAgICAgIHRoaXMuZHJhd0JvdW5kaW5nQm94ID0gb3B0aW9ucy5iYm94O1xuICAgIH1cbiAgfVxuXG4gIFdpZGdldC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oY3R4KSB7XG4gICAgdmFyIGJpdCwgbXR4O1xuICAgIGJpdCA9IHtcbiAgICAgIFwiZmFsc2VcIjogLTEsXG4gICAgICBcInRydWVcIjogMVxuICAgIH07XG4gICAgbXR4ID0gdGhpcy5fbWF0cml4LmNsb25lKCkuaWRlbnRpdHkoKS5hcHBlbmRUcmFuc2Zvcm0odGhpcy5wb3NpdGlvbi54ICsgdGhpcy53aWR0aCAqICh0aGlzLmZsaXBYICsgMCksIHRoaXMucG9zaXRpb24ueSArIHRoaXMuaGVpZ2h0ICogKHRoaXMuZmxpcFkgKyAwKSwgdGhpcy5zY2FsZS54ICogYml0WyF0aGlzLmZsaXBYXSwgdGhpcy5zY2FsZS55ICogYml0WyF0aGlzLmZsaXBZXSwgdGhpcy5yb3RhdGlvbiwgdGhpcy5za2V3LngsIHRoaXMuc2tldy55LCB0aGlzLnBpdm90LngsIHRoaXMucGl2b3QueSk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC50cmFuc2xhdGUodGhpcy5wb3NpdGlvbi54LCB0aGlzLnBvc2l0aW9uLnkpO1xuICAgIGN0eC50cmFuc2Zvcm0obXR4Lm0xMSwgbXR4Lm0xMiwgbXR4Lm0yMSwgbXR4Lm0yMiwgbXR4LmR4LCBtdHguZHkpO1xuICAgIGN0eC5zZXRBbHBoYSh0aGlzLmFscGhhKTtcbiAgICBpZiAodGhpcy5jb21wb3NpdGVPcGVyYXRpb24pIHtcbiAgICAgIGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSB0aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbjtcbiAgICB9XG4gICAgY3R4W1N1cHBvcnQuaW1hZ2VTbW9vdGhpbmdFbmFibGVkXSA9IHRoaXMuc21vb3RoO1xuICAgIGlmICh0aGlzLmRyYXdCb3VuZGluZ0JveCA9PT0gdHJ1ZSkge1xuICAgICAgY3R4LnNldEFscGhhKDEpO1xuICAgICAgY3R4LnJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgIH1cbiAgICBjdHguc2V0QWxwaGEodGhpcy5hbHBoYSk7XG4gICAgaWYgKHRoaXMuX3JlbmRlcikge1xuICAgICAgdGhpcy5fcmVuZGVyKGN0eCk7XG4gICAgfVxuICAgIGN0eC50cmFuc2xhdGUoLXRoaXMucG9zaXRpb24ueCwgLXRoaXMucG9zaXRpb24ueSk7XG4gICAgcmV0dXJuIGN0eC5jbG9zZVBhdGgoKTtcbiAgfTtcblxuICByZXR1cm4gV2lkZ2V0O1xuXG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdpZGdldDtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPXdpZGdldC5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgQ29sb3I7XG5cbkNvbG9yID0gKGZ1bmN0aW9uKCkge1xuICAvKlxuICBAcGFyYW0ge1N0cmluZyB8IE51bWJlcn0gaGV4T3JSZWQgaGV4YWRlY2ltYWwgY29sb3IgKFN0cmluZyksIG9yIHJlZCAoTnVtYmVyKVxuICBAcGFyYW0ge051bWJlcn0gZ3JlZW5cbiAgQHBhcmFtIHtOdW1iZXJ9IGJsdWVcbiAgQHBhcmFtIHtOdW1iZXJ9IGFscGhhXG4gIFxuICBAZXhhbXBsZVxuICAvLyBjb2xvciBuYW1lXG4gIHZhciBjb2xvciA9IG5ldyBKb3kuQ29sb3IoXCJyZWRcIik7XG4gIFxuICBAZXhhbXBsZVxuICAvLyBoZXhhZGVjaW1hbFxuICB2YXIgY29sb3IgPSBuZXcgSm95LkNvbG9yKFwiI2ZmZlwiKTtcbiAgXG4gIEBleGFtcGxlXG4gIC8vIHJnYlxuICB2YXIgY29sb3IgPSBuZXcgSm95LkNvbG9yKDI1NSwgNTAsIDI1NSk7XG4gIFxuICBAZXhhbXBsZVxuICAvLyByZ2JhXG4gIHZhciBjb2xvciA9IG5ldyBKb3kuQ29sb3IoMjU1LCA1MCwgMjU1LCAxMDApO1xuICBcbiAgQGNsYXNzIENvbG9yXG4gIEBjb25zdHJ1Y3RvclxuICAqL1xuXG4gIGZ1bmN0aW9uIENvbG9yKHIsIGcsIGIsIGEpIHtcbiAgICB0aGlzLnIgPSByICE9IG51bGwgPyByIDogMDtcbiAgICB0aGlzLmcgPSBnICE9IG51bGwgPyBnIDogMDtcbiAgICB0aGlzLmIgPSBiICE9IG51bGwgPyBiIDogMDtcbiAgICB0aGlzLmEgPSBhICE9IG51bGwgPyBhIDogMTtcbiAgfVxuXG4gIENvbG9yLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciByO1xuICAgIGlmICghdGhpcy5ncmVlbiAmJiAhdGhpcy5ibHVlKSB7XG4gICAgICByID0gdGhpcy5yZWQ7XG4gICAgfSBlbHNlIGlmICh0aGlzLmFscGhhKSB7XG4gICAgICByID0gXCJyZ2JhKCBcIiArIHRoaXMucmVkICsgXCIsIFwiICsgdGhpcy5ncmVlbiArIFwiLCBcIiArIHRoaXMuYmx1ZSArIFwiLCBcIiArIHRoaXMuYWxwaGEgKyBcIilcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgciA9IFwicmdiKCBcIiArIHRoaXMucmVkICsgXCIsIFwiICsgdGhpcy5ncmVlbiArIFwiLCBcIiArIHRoaXMuYmx1ZSArIFwiKVwiO1xuICAgIH1cbiAgICByZXR1cm4gcjtcbiAgfTtcblxuICBDb2xvci5yYW5kb20gPSBmdW5jdGlvbihhbHBoYSkge1xuICAgIGlmIChhbHBoYSA9PSBudWxsKSB7XG4gICAgICBhbHBoYSA9IDI1NTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBDb2xvcihwYXJzZUludChNYXRoLnJhbmRvbSgpICogMjU1LCAxMCksIHBhcnNlSW50KE1hdGgucmFuZG9tKCkgKiAyNTUsIDEwKSwgcGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIDI1NSwgMTApLCBhbHBoYSk7XG4gIH07XG5cbiAgcmV0dXJuIENvbG9yO1xuXG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbG9yO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9Y29sb3IubWFwXG4qL1xuIl19
;