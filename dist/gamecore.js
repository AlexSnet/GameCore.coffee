;(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(require,module,exports){
(function(){// Generated by CoffeeScript 1.6.3
var GameCore, Stage, UUID, context2d, support;

context2d = require("./core/context/2d");

support = require("./core/support");

UUID = require("./math/uuid");

Stage = require("./ui/stage");

/*
Game Core base class

@property {Stage} stage
@property {Boolean} fullScreen
@property {Boolean} paused
@property {Context} context
@property {Int} width
@property {Int} heigth
@property {DOMElement} renderer

@example How to create an game core 
    gc = new GameCore() # Creating core
    gc.renderer = document.body # Appends new canvas element to documents body

@example Making canvas full-sized
    gc = new GameCore() # Creating core
    gc.fullScreen = true
*/


GameCore = (function() {
  /*
  GameCore instancec archive
  */

  GameCore.cores = {};

  /*
  Start your application from here.
  
  @param {Object} options
  */


  function GameCore(options) {
    this.options = options != null ? options : {};
    /*
    In the first case we need to generate id for new instance, if it not
     present in options.
    */

    this.id = this.options.id || UUID.generateUniqueId();
    /*
    Setting up a canvas.
    If canvas doesn't present in options then create it.
    */

    this.options.canvas = this.options.canvas || this.createCanvas();
    /*
    Registrating GameCore instance in canvas ang GameCore global.
    */

    this.options.canvas.core = this;
    GameCore.cores[this.id] = this;
    /*
    Setting up framerate
    */

    this.setFramerate();
    this._frame = 0;
    /*
    Stages map
    */

    this._stages = {};
    Object.defineProperty(this, "stage", {
      get: function() {
        var stage;
        if (this._current_stage_id) {
          return this._stages[this._current_stage_id];
        } else {
          stage = new Stage;
          this._current_stage_id = stage.id;
          this.addStage(stage);
          return stage;
        }
      },
      set: function(stage) {
        if (!this._stages[stage.id]) {
          this.addStage(stage);
        }
        return this._current_stage_id = stage.id;
      }
    });
    /*
    */

    Object.defineProperty(this, "fullScreen", {
      get: function() {
        return this._in_the_fullscreen_now;
      },
      set: function(b) {
        if (b === true) {
          window.addEventListener("resize", this._fullScreen_resizer);
          this._in_the_fullscreen_now = true;
          return this.setSize(document.width, document.height);
        } else {
          window.removeEventListener("resize", this._fullScreen_resizer);
          this._in_the_fullscreen_now = false;
          return this.setSize(this.options.width, this.options.height);
        }
      }
    });
    this.fullScreen = this.options.fullScreen;
    /*
    */

    Object.defineProperty(this, "width", {
      get: function() {
        return this.options.canvas.width;
      },
      set: function(width) {
        this.options.canvas.width = width;
        return this.options.canvas.style.width = width + "px";
      }
    });
    /*
    */

    Object.defineProperty(this, "height", {
      get: function() {
        return this.options.canvas.height;
      },
      set: function(height) {
        this.options.canvas.height = height;
        return this.options.canvas.style.height = height + "px";
      }
    });
    if (this.fullScreen) {
      this.options.width = window.width;
      this.options.height = window.height;
    }
    this.setSize(this.options.width, this.options.height);
    /*
    Context element.
    Currently support only Context2d
    */

    Object.defineProperty(this, "context", {
      get: function() {
        if (!this._context) {
          this._context = new context2d({
            canvas: this.options.canvas
          });
        }
        return this._context;
      }
    });
    /*
    */

    Object.defineProperty(this, "paused", {
      get: function() {
        return this._paused || false;
      },
      set: function(paused) {
        return this._paused = paused ? true : false;
      }
    });
    /*
    Renderer element.
    */

    Object.defineProperty(this, "renderer", {
      get: function() {
        return this._parent_node || 'undefined';
      },
      set: function(node) {
        if (!node.tagName) {
          throw Error("Can render only on document elements");
        }
        node.appendChild(this.options.canvas);
        return this._parent_node = node;
      }
    });
    this._onEnterFrame();
  }

  /*
  */


  GameCore.prototype.addStage = function(stage, setCurrent) {
    if (setCurrent == null) {
      setCurrent = false;
    }
    this._stages[stage.id] = stage;
    if (setCurrent) {
      return this.stage = stage.id;
    }
  };

  /*
  Switch pause state
  */


  GameCore.prototype.pause = function() {
    return this.paused = !this.paused;
  };

  /*
  Set's framerate. Not usable at the moment...
  @param {Int} framerate
  @method setFramerate
  */


  GameCore.prototype.setFramerate = function(framerate) {
    if (framerate == null) {
      framerate = 60;
    }
    return window._FPS = framerate;
  };

  /*
  Set size of an canvas element.
  @param {Int} width
  @param {Int} height
  @method setSize
  */


  GameCore.prototype.setSize = function(width, height) {
    if (width == null) {
      width = 400;
    }
    if (height == null) {
      height = 300;
    }
    this.width = width;
    return this.height = height;
  };

  GameCore.prototype._fullScreen_resizer = function() {
    var gci;
    gci = this;
    return function(e) {
      return gci.setSize(window.width, window.height);
    };
  };

  /*
  Creates a canvas element
  @method createCanvas
  */


  GameCore.prototype.createCanvas = function() {
    var canvas;
    canvas = document.createElement('canvas');
    return canvas;
  };

  /*
  Call window's requestAnimationFrame.
  @method _onEnterFrame
  */


  GameCore.prototype._onEnterFrame = function(gci) {
    if (gci == null) {
      gci = this;
    }
    if (!this.paused) {
      gci._render(gci.stage);
    }
    return window.onEnterFrame(function() {
      return gci._onEnterFrame(gci);
    });
  };

  GameCore.prototype._render = function() {
    this._frame++;
    return this.context.render([this.stage]);
  };

  return GameCore;

})();

window.GameCore = window.GameCore || GameCore;

GameCore.exports = {
  UI: require("./ui/exports"),
  Math: require("./math/exports")
};

module.exports = GameCore;

/*
//@ sourceMappingURL=core.map
*/

})()
},{"./core/context/2d":2,"./core/support":3,"./math/exports":4,"./math/uuid":6,"./ui/exports":9,"./ui/stage":13}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Context2d;

Context2d = (function() {
  function Context2d(options) {
    this.setCanvas(options.canvas);
  }

  Context2d.prototype.setCanvas = function(canvas) {
    this.canvas = canvas;
    this.ctx = this.canvas.getContext('2d');
    return this;
  };

  Context2d.prototype.clear = function() {
    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);
    return this;
  };

  Context2d.prototype.render = function(layers) {
    var layer, _i, _len, _results;
    if (layers == null) {
      layers = [];
    }
    this.clear();
    _results = [];
    for (_i = 0, _len = layers.length; _i < _len; _i++) {
      layer = layers[_i];
      _results.push(layer.render(this.ctx));
    }
    return _results;
  };

  return Context2d;

})();

module.exports = Context2d;

/*
//@ sourceMappingURL=2d.map
*/

},{}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var browserPrefix, prefix, userAgent;

prefix = function(name) {
  if (browserPrefix !== "") {
    name = name.charAt(0).toUpperCase() + name.slice(1);
  }
  return browserPrefix + name;
};

userAgent = navigator.userAgent;

browserPrefix = (userAgent.match(/opera/i) && "o") || (userAgent.match(/webkit/i) && "webkit") || (userAgent.match(/msie/i) && "ms") || (userAgent.match(/mozilla/i) && "moz") || "";

Function.prototype.property = function(prop, desc) {
  return Object.defineProperty(this.prototype, prop, desc);
};

if (typeof window.addEventListener !== "function") {
  HTMLElement.prototype.addEventListener = function(type, callback, useCapture) {
    return attachEvent("on" + type, callback);
  };
}

/*
window.onEnterFrame
*/


window.onEnterFrame = (function() {
  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
    return window.setTimeout(callback, 1000 / window._FPS);
  };
})();

module.exports = {
  /*
  Browser's user-agent string
  @attribute userAgent
  @type {String}
  @static
  @readonly
  */

  userAgent: userAgent,
  /*
  Device supports touch events?
  @attribute touch
  @type {Boolean}
  @static
  @readonly
  */

  touch: "ontouchstart" in window,
  /*
  Device supports Retina Display?
  @attribute retina
  @type {Boolean}
  @static
  @readonly
  */

  retina: window.devicePixelRatio > 1 || window.matchMedia("(min-resolution: 1.1dppx)").matches,
  imageSmoothingEnabled: prefix("imageSmoothingEnabled")
};

/*
//@ sourceMappingURL=support.map
*/

},{}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
module.exports = {
  Matrix2D: require("./matrix2d"),
  Vector2D: require("./vector2d"),
  UUID: require("./uuid")
};

/*
//@ sourceMappingURL=exports.map
*/

},{"./matrix2d":5,"./uuid":6,"./vector2d":7}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Matrix2D;

Matrix2D = (function() {
  /*
  Based on [EaselJS](https://github.com/CreateJS/EaselJS/) Matrix2D implementation.
  
  @class Matrix2D
  @constructor
  
  @param {Number} m11
  @param {Number} m12
  @param {Number} m21
  @param {Number} m22
  @param {Number} dx
  @param {Number} dy
  */

  function Matrix2D(m11, m12, m21, m22, dx, dy) {
    if (m11 !== null) {
      this.m11 = m11;
    }
    this.m12 = m12 || 0;
    this.m21 = m21 || 0;
    if (m22 !== null) {
      this.m22 = m22;
    }
    this.dx = dx || 0;
    this.dy = dy || 0;
  }

  /*
  Generates matrix properties from the specified display object transform properties, and appends them with this matrix.
  For example, you can use this to generate m11 matrix from m11 display object: var mtx = new Matrix2D();
  mtx.appendTransform(o.x, o.y, o.scaleX, o.scaleY, o.rotation);
  @method appendTransform
  @param {Number} x
  @param {Number} y
  @param {Number} scaleX
  @param {Number} scaleY
  @param {Number} rotation
  @param {Number} skewX
  @param {Number} skewY
  @param {Number} pivotX Optional.
  @param {Number} pivotY Optional.
  @return {Matrix2D} This matrix. Useful for chaining method calls.
  */


  Matrix2D.prototype.appendTransform = function(x, y, scaleX, scaleY, rotation, skewX, skewY, pivotX, pivotY) {
    var cos, r, sin;
    cos = void 0;
    sin = void 0;
    r = void 0;
    if (rotation % 360) {
      r = rotation * Matrix2D.DEG_TO_RAD;
      cos = Math.cos(r);
      sin = Math.sin(r);
    } else {
      cos = 1;
      sin = 0;
    }
    if (skewX || skewY) {
      skewX *= Matrix2D.DEG_TO_RAD;
      skewY *= Matrix2D.DEG_TO_RAD;
      this.append(Math.cos(skewY), Math.sin(skewY), -Math.sin(skewX), Math.cos(skewX), x, y);
      this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, 0, 0);
    } else {
      this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, x, y);
    }
    if (pivotX || pivotY) {
      this.dx -= pivotX * this.m11 + pivotY * this.m21;
      this.dy -= pivotX * this.m12 + pivotY * this.m22;
    }
    return this;
  };

  /*
  Appends the specified matrix properties with this matrix. All parameters are required.
  @method append
  @param {Number} m11
  @param {Number} m12
  @param {Number} m21
  @param {Number} m22
  @param {Number} dx
  @param {Number} dy
  @return {Matrix2D} This matrix. Useful for chaining method calls.
  */


  Matrix2D.prototype.append = function(m11, m12, m21, m22, dx, dy) {
    var a1, b1, c1, d1;
    a1 = this.m11;
    b1 = this.m12;
    c1 = this.m21;
    d1 = this.m22;
    this.m11 = m11 * a1 + m12 * c1;
    this.m12 = m11 * b1 + m12 * d1;
    this.m21 = m21 * a1 + m22 * c1;
    this.m22 = m21 * b1 + m22 * d1;
    this.dx = dx * a1 + dy * c1 + this.dx;
    this.dy = dx * b1 + dy * d1 + this.dy;
    return this;
  };

  /*
  Inverts the matrix, causing it to perform the opposite transformation.
  @method invert
  @return {Matrix2D} this
  */


  Matrix2D.prototype.invert = function() {
    var a1, b1, c1, d1, n, tx1;
    a1 = this.m11;
    b1 = this.m12;
    c1 = this.m21;
    d1 = this.m22;
    tx1 = this.dx;
    n = a1 * d1 - b1 * c1;
    this.m11 = d1 / n;
    this.m12 = -b1 / n;
    this.m21 = -c1 / n;
    this.m22 = a1 / n;
    this.dx = (c1 * this.dy - d1 * tx1) / n;
    this.dy = -(a1 * this.dy - b1 * tx1) / n;
    return this;
  };

  /*
  Clone Matrix2D instance
  @return {Matrix2D}
  */


  Matrix2D.prototype.clone = function() {
    return new Matrix2D(this.m11, this.m12, this.m21, this.m22, this.dx, this.dy);
  };

  /*
  Reset matrix to it's identity
  @return {Matrix2D} this
  */


  Matrix2D.prototype.identity = function() {
    this.m11 = this.m22 = 1;
    this.m12 = this.m21 = this.dx = this.dy = 0;
    return this;
  };

  /*           
  Multiplier for converting degrees to radians. Used internally by Matrix2D.
  
  @attribute DEG_TO_RAD
  @static
  @readonly
  @return {Number}
  */


  Matrix2D.DEG_TO_RAD = Math.PI / 180;

  Matrix2D.identity = new Matrix2D(1, 0, 0, 1, 0, 0);

  return Matrix2D;

})();

module.exports = Matrix2D;

/*
//@ sourceMappingURL=matrix2d.map
*/

},{}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var UUID;

UUID = (function() {
  function UUID() {}

  /*
  @method generateUniqueId
  @return {String}
  */


  UUID.generateUniqueId = function() {
    return "gc-" + this.uuid();
  };

  /*
  @method uuid
  @return {String}
  */


  UUID.uuid = function() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      var r, v;
      r = Math.random() * 16 | 0;
      v = c === 'x' ? r : r & 0x3 | 0x8;
      return v.toString(16);
    });
  };

  return UUID;

})();

module.exports = UUID;

/*
//@ sourceMappingURL=uuid.map
*/

},{}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Vector2d;

Vector2d = (function() {
  function Vector2d(x, y) {
    this.x = x != null ? x : 0;
    this.y = y != null ? y : 0;
    /*
    Get the magnitude of this vector
    @attribute length
    @readonly
    */

    Object.defineProperty(this, "length", {
      get: function() {
        return Math.sqrt((this.x * this.x) + (this.y * this.y));
      },
      configurable: true
    });
    /*
    Get this vector with a magnitude of 1.
    @attribute normalized
    @readonly
    */

    Object.defineProperty(this, "normalized", {
      get: function() {
        var magnitude;
        magnitude = this.length;
        return new Vector2d(this.x / magnitude, this.y / magnitude);
      },
      configurable: true
    });
  }

  /*
  @method set
  @param {Number} x
  @param {Number} y
  @return {Vector2d}
  */


  Vector2d.prototype.set = function(x, y) {
    this.x = x;
    this.y = y;
  };

  /*
  @method sum
  @param {Vector2d} vector2d
  @return {Vector2d}
  */


  Vector2d.prototype.subtract = function(vector2d) {
    this.x -= vector2d.x;
    return this.y -= vector2d.y;
  };

  /*
  @method sum
  @param {Vector2d} vector2d
  @return {Vector2d}
  */


  Vector2d.prototype.sum = function(vector2d) {
    this.x += vector2d.x;
    return this.y += vector2d.y;
  };

  /*
  @method scale
  @param {Number} x (or x y)
  @param {Number} y
  @return {Vector2d}
  */


  Vector2d.prototype.scale = function(x, y) {
    this.x *= x;
    return this.y *= y || x;
  };

  /*
  @method clone
  @return {Vector2d}
  */


  Vector2d.prototype.clone = function() {
    return new Vector2d(this.x, this.y);
  };

  /*
  Return unit vector
  @return {Vector2d}
  */


  Vector2d.prototype.unit = function() {
    return new Vector2d(Math.cos(this.x), Math.sin(this.y));
  };

  /*
  Normalize this vector
  @return {Vector2d}
  */


  Vector2d.prototype.normalize = function() {
    var normal;
    normal = this.normalized;
    this.x = normal.x;
    return this.y = normal.y;
  };

  /*
  Get the distance between this vector and the argument vector
  @param {Vector2d} vector
  @return {Number}
  */


  Vector2d.distance = function(v1, v2) {
    var xdiff, ydiff;
    xdiff = v1.x - v2.x;
    ydiff = v1.y - v2.y;
    return Math.sqrt(xdiff * xdiff + ydiff * ydiff);
  };

  /*
  @method toString
  @return {String}
  */


  Vector2d.prototype.toString = function() {
    return "#<Vector2d @x=" + this.x + ", @y=" + this.y + ">";
  };

  Vector2d.LEFT = new Vector2d(-1, 0);

  Vector2d.RIGHT = new Vector2d(1, 0);

  Vector2d.TOP = new Vector2d(0, -1);

  Vector2d.BOTTOM = new Vector2d(0, 1);

  return Vector2d;

})();

module.exports = Vector2d;

/*
//@ sourceMappingURL=vector2d.map
*/

},{}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Container, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("./widget");

Container = (function(_super) {
  __extends(Container, _super);

  function Container(options) {
    if (options == null) {
      options = {};
    }
    Container.__super__.constructor.call(this, options);
    this.children = {};
  }

  Container.prototype.addChild = function(child) {
    if (child.parent === !this) {
      return child.parent = this;
    } else {
      return this.children[child.id] = child;
    }
  };

  Container.prototype.render = function(ctx) {
    var child, cid, _ref, _results;
    Container.__super__.render.call(this, ctx);
    _ref = this.children;
    _results = [];
    for (cid in _ref) {
      child = _ref[cid];
      _results.push(child.render(ctx));
    }
    return _results;
  };

  return Container;

})(Widget);

module.exports = Container;

/*
//@ sourceMappingURL=container.map
*/

},{"./widget":15}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
module.exports = {
  Widget: require("./widget"),
  Stage: require("./stage"),
  Container: require("./container"),
  Text: require("./text"),
  geometry: require("./geometry/exports")
};

/*
//@ sourceMappingURL=exports.map
*/

},{"./container":8,"./geometry/exports":11,"./stage":13,"./text":14,"./widget":15}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Circle, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("../widget");

Circle = (function(_super) {
  __extends(Circle, _super);

  function Circle(options) {
    if (options == null) {
      options = {};
    }
    Circle.__super__.constructor.call(this, options);
  }

  return Circle;

})(Widget);

/*
//@ sourceMappingURL=circle.map
*/

},{"../widget":15}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
module.exports = {
  Circle: require("./circle"),
  Rect: require("./rect")
};

/*
//@ sourceMappingURL=exports.map
*/

},{"./circle":10,"./rect":12}],12:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Rect, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("../widget");

Rect = (function(_super) {
  __extends(Rect, _super);

  function Rect(options) {
    if (options == null) {
      options = {};
    }
    Rect.__super__.constructor.call(this, options);
  }

  return Rect;

})(Widget);

/*
//@ sourceMappingURL=rect.map
*/

},{"../widget":15}],13:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Stage, container,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

container = require("../ui/container");

Stage = (function(_super) {
  __extends(Stage, _super);

  function Stage(options) {
    if (options == null) {
      options = {};
    }
    Stage.__super__.constructor.call(this, options);
    this.x = 0;
    this.y = 0;
  }

  Stage.prototype.render = function(ctx) {
    this.width = ctx.canvas.width;
    this.height = ctx.canvas.height;
    return Stage.__super__.render.call(this, ctx);
  };

  return Stage;

})(container);

module.exports = Stage;

/*
//@ sourceMappingURL=stage.map
*/

},{"../ui/container":8}],14:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var BASELINE, DEFAULT_ALIGN, DEFAULT_BASELINE, DEFAULT_COLOR, DEFAULT_FONT, Text, Widget,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Widget = require("./widget");

/*
Object.defineProperty this, BASELINE
@static
*/


BASELINE = {
  /*
  Object.defineProperty this, BASELINE.TOP
  @type {String}
  @static
  */

  TOP: "top",
  /*
  Object.defineProperty this, BASELINE.HANGING
  @type {String}
  @static
  */

  HANGING: "hanging",
  /*
  Object.defineProperty this, BASELINE.MIDDLE
  @type {String}
  @static
  */

  MIDDLE: "middle",
  /*
  Object.defineProperty this, BASELINE.ALPHABETIC
  @type {String}
  @static
  */

  ALPHABETIC: "alphabetic",
  /*
  Object.defineProperty this, BASELINE.IDEOGRAPHIC
  @type {String}
  @static
  */

  IDEOGRAPHIC: "ideographic",
  /*
  Object.defineProperty this, BASELINE.BOTTOM
  @type {String}
  @static
  */

  BOTTOM: "bottom"
};

DEFAULT_FONT = "Normal 12px Verdana";

DEFAULT_COLOR = "#000000";

DEFAULT_ALIGN = "left";

DEFAULT_BASELINE = BASELINE.TOP;

Text = (function(_super) {
  __extends(Text, _super);

  /*
  @class Text
  @extends DisplayObject
  
  @param {Object} options any attribute may be initialized by option
  @param {String} [options.text] default - ""
  @param {String} [options.font] default - "Normal 12px Verdana"
  @param {String} [options.align] default - "left"
  @param {String} [options.baseline] default - Joy.Text.BASELINE.TOP
  @param {String} [options.color] default - #000000
  
  @constructor
  */


  function Text(options) {
    if (options == null) {
      options = {};
    }
    Text.__super__.constructor.call(this, options);
    /*
    Text to be displayed
    @attribute text
    @default ""
    @type {String}
    */

    this.text = options.text || "";
    /*
    Font family and size
    @attribute font
    @default "Normal 12px Verdana"
    @type {String}
    */

    this.font = options.font || DEFAULT_FONT;
    /*
    Text horizontal alignment
    @attribute align
    @default "left"
    @type {String}
    */

    this.align = options.align || DEFAULT_ALIGN;
    /*
    Text vertical baseline
    @attribute baseline
    @default Joy.Text.BASELINE.TOP
    @type {String}
    */

    this.baseline = options.baseline || DEFAULT_BASELINE;
    /*
    Color of the text
    @attribute color
    @default "#000000"
    @type {String, Color}
    */

    this._color = options.color || DEFAULT_COLOR;
    Object.defineProperty(this, "color", {
      get: function() {
        return this._color;
      },
      set: function(color) {
        return this._color = color.toString();
      },
      configurable: true
    });
    if (options.stroke) {
      this.useStroke();
    } else {
      this.useFill();
    }
    Object.defineProperty(this, "width", {
      get: function() {
        if (this.__measure) {
          return this.__measure.width;
        } else {
          return 0;
        }
      }
    });
    Object.defineProperty(this, "height", {
      get: function() {
        if (this.__measure) {
          return this.__measure.height;
        } else {
          return 0;
        }
      }
    });
  }

  /*
  @method useStroke
  */


  Text.prototype.useStroke = function() {
    this.stroke = true;
    this.fillMethod = "strokeText";
    return this.styleMethod = "strokeStyle";
  };

  /*
  @method useFill
  */


  Text.prototype.useFill = function() {
    this.stroke = false;
    this.fillMethod = "fillText";
    return this.styleMethod = "fillStyle";
  };

  Text.prototype._render = function(ctx) {
    ctx.font = this.font;
    ctx.textAlign = this.align;
    ctx.textBaseline = this.baseline;
    ctx[this.styleMethod] = this.color;
    ctx[this.fillMethod](this.text, 0, 0);
    return this.getMeasure(ctx);
  };

  /*
  @method getMeasure
  @return {TextMetrics} text metrics
  */


  Text.prototype.getMeasure = function(ctx) {
    var m;
    this.__measure = {};
    m = Text.MeasureText(this.text, this.font);
    this.__measure.width = m[0];
    return this.__measure.height = m[1];
  };

  Text.BASELINE = BASELINE;

  Text.MeasureText = function(text, font) {
    var div, size, str;
    str = text + ":" + font;
    if (typeof this.__measuretext_cache__ === "object" && this.__measuretext_cache__[str]) {
      return this.__measuretext_cache__[str];
    }
    div = document.createElement("DIV");
    div.innerHTML = text;
    div.style.position = "absolute";
    div.style.top = "-100px";
    div.style.left = "-100px";
    div.style.font = font;
    console.log(div.style.fontFamily, div.style.fontWeight, div.style.fontSize);
    document.body.appendChild(div);
    size = [div.offsetWidth, div.offsetHeight];
    document.body.removeChild(div);
    if (typeof this.__measuretext_cache__ !== "object") {
      this.__measuretext_cache__ = {};
    }
    this.__measuretext_cache__[str] = size;
    return size;
  };

  return Text;

})(Widget);

module.exports = Text;

/*
//@ sourceMappingURL=text.map
*/

},{"./widget":15}],15:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Color, Core, Matrix2d, Support, UUID, Vector2d, Widget;

Core = require("../core");

UUID = require("../math/uuid");

Vector2d = require("../math/vector2d");

Matrix2d = require("../math/matrix2d");

Support = require("../core/support");

Color = require("../utils/color");

/*
Base renderable element
*/


Widget = (function() {
  function Widget(options) {
    if (options == null) {
      options = {};
    }
    this.id = UUID.generateUniqueId();
    /*
    @attribute pivot
    @type {Vector2d}
    @default 0,0
    */

    this.pivot = options.pivot || new Vector2d(options.pivotX || 0, options.pivotY || 0);
    /*
    @attribute skewX
    @type {Number}
    @default 0
    */

    this.skew = options.skew || new Vector2d(options.skewX || 0, options.skewY || 0);
    /*
    @attribute scale
    @type {Vector2d}
    @default 1,1
    */

    this.scale = options.scale || new Vector2d(options.scaleX || 1, options.scaleY || 1);
    /*
    @attribute alpha
    @type {Number}
    @default 1
    */

    this.alpha = (typeof options.alpha === "undefined" ? 1 : options.alpha);
    /*
    @attribute rotation
    @type {Number}
    @default 0
    */

    this.rotation = options.rotation || 0;
    /*
    @attribute smooth
    @type {Boolean}
    @default false
    */

    this.smooth = (typeof options.smooth === "undefined" ? true : options.smooth);
    this._matrix = Matrix2d.identity.clone();
    Object.defineProperty(this, "position", {
      get: function() {
        if (!this._position) {
          this._position = new Vector2d(0, 0);
        }
        return this._position;
      },
      set: function(vector) {
        return this._position = vector.clone();
      }
    });
    Object.defineProperty(this, "x", {
      get: function() {
        return this.position.x || 0;
      },
      set: function(x) {
        return this.position.x = x;
      }
    });
    if (options.x) {
      this.x = options.x;
    }
    Object.defineProperty(this, "y", {
      get: function() {
        return this.position.y || 0;
      },
      set: function(y) {
        return this.position.y = y;
      }
    });
    if (options.y) {
      this.y = options.y;
    }
    Object.defineProperty(this, "width", {
      get: function() {
        return this._width || 10;
      },
      set: function(w) {
        return this._width = w;
      },
      configurable: true
    });
    if (options.width) {
      this.width = options.width;
    }
    Object.defineProperty(this, "height", {
      get: function() {
        return this._height || 10;
      },
      set: function(h) {
        return this._height = h;
      },
      configurable: true
    });
    if (options.height) {
      this.height = options.height;
    }
    Object.defineProperty(this, "parent", {
      get: function() {
        return this._parent || 'undefined';
      },
      set: function(parent) {
        this._parent = parent;
        return this._parent.addChild(this);
      }
    });
    if (options.parent) {
      this.parent = options.parent;
    }
    Object.defineProperty(this, "drawBoundingBox", {
      get: function() {
        return this._bounding_box || false;
      },
      set: function(boool) {
        return this._bounding_box = boool || false;
      }
    });
    if (options.bbox) {
      this.drawBoundingBox = options.bbox;
    }
  }

  Widget.prototype.render = function(ctx) {
    var bit, mtx;
    bit = {
      "false": -1,
      "true": 1
    };
    mtx = this._matrix.clone().identity().appendTransform(this.position.x + this.width * (this.flipX + 0), this.position.y + this.height * (this.flipY + 0), this.scale.x * bit[!this.flipX], this.scale.y * bit[!this.flipY], this.rotation, this.skew.x, this.skew.y, this.pivot.x, this.pivot.y);
    ctx.beginPath();
    ctx.translate(this.position.x, this.position.y);
    ctx.transform(mtx.m11, mtx.m12, mtx.m21, mtx.m22, mtx.dx, mtx.dy);
    ctx.setAlpha(this.alpha);
    if (this.compositeOperation) {
      ctx.globalCompositeOperation = this.compositeOperation;
    }
    ctx[Support.imageSmoothingEnabled] = this.smooth;
    if (this.drawBoundingBox === true) {
      ctx.setAlpha(1);
      ctx.rect(0, 0, this.width, this.height);
    }
    ctx.setAlpha(this.alpha);
    if (this._render) {
      this._render(ctx);
    }
    ctx.translate(-this.position.x, -this.position.y);
    return ctx.closePath();
  };

  return Widget;

})();

module.exports = Widget;

/*
//@ sourceMappingURL=widget.map
*/

},{"../core":1,"../core/support":3,"../math/matrix2d":5,"../math/uuid":6,"../math/vector2d":7,"../utils/color":16}],16:[function(require,module,exports){
// Generated by CoffeeScript 1.6.3
var Color;

Color = (function() {
  /*
  @param {String | Number} hexOrRed hexadecimal color (String), or red (Number)
  @param {Number} green
  @param {Number} blue
  @param {Number} alpha
  
  @example
  // color name
  var color = new Joy.Color("red");
  
  @example
  // hexadecimal
  var color = new Joy.Color("#fff");
  
  @example
  // rgb
  var color = new Joy.Color(255, 50, 255);
  
  @example
  // rgba
  var color = new Joy.Color(255, 50, 255, 100);
  
  @class Color
  @constructor
  */

  function Color(r, g, b, a) {
    this.r = r != null ? r : 0;
    this.g = g != null ? g : 0;
    this.b = b != null ? b : 0;
    this.a = a != null ? a : 1;
  }

  Color.prototype.toString = function() {
    var r;
    if (!this.green && !this.blue) {
      r = this.red;
    } else if (this.alpha) {
      r = "rgba( " + this.red + ", " + this.green + ", " + this.blue + ", " + this.alpha + ")";
    } else {
      r = "rgb( " + this.red + ", " + this.green + ", " + this.blue + ")";
    }
    return r;
  };

  Color.random = function(alpha) {
    if (alpha == null) {
      alpha = 255;
    }
    return new Color(parseInt(Math.random() * 255, 10), parseInt(Math.random() * 255, 10), parseInt(Math.random() * 255, 10), alpha);
  };

  return Color;

})();

module.exports = Color;

/*
//@ sourceMappingURL=color.map
*/

},{}]},{},[1])
//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC9jb3JlLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvY29yZS9jb250ZXh0LzJkLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvY29yZS9zdXBwb3J0LmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvbWF0aC9leHBvcnRzLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvbWF0aC9tYXRyaXgyZC5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL21hdGgvdXVpZC5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL21hdGgvdmVjdG9yMmQuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS9jb250YWluZXIuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS9leHBvcnRzLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvdWkvZ2VvbWV0cnkvY2lyY2xlLmpzIiwiL1VzZXJzL2FsZXgvQ29kaW5nL0dhbWVDb3JlLy50bXAvdWkvZ2VvbWV0cnkvZXhwb3J0cy5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL3VpL2dlb21ldHJ5L3JlY3QuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS9zdGFnZS5qcyIsIi9Vc2Vycy9hbGV4L0NvZGluZy9HYW1lQ29yZS8udG1wL3VpL3RleHQuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91aS93aWRnZXQuanMiLCIvVXNlcnMvYWxleC9Db2RpbmcvR2FtZUNvcmUvLnRtcC91dGlscy9jb2xvci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpey8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBHYW1lQ29yZSwgU3RhZ2UsIFVVSUQsIGNvbnRleHQyZCwgc3VwcG9ydDtcblxuY29udGV4dDJkID0gcmVxdWlyZShcIi4vY29yZS9jb250ZXh0LzJkXCIpO1xuXG5zdXBwb3J0ID0gcmVxdWlyZShcIi4vY29yZS9zdXBwb3J0XCIpO1xuXG5VVUlEID0gcmVxdWlyZShcIi4vbWF0aC91dWlkXCIpO1xuXG5TdGFnZSA9IHJlcXVpcmUoXCIuL3VpL3N0YWdlXCIpO1xuXG4vKlxuR2FtZSBDb3JlIGJhc2UgY2xhc3NcblxuQHByb3BlcnR5IHtTdGFnZX0gc3RhZ2VcbkBwcm9wZXJ0eSB7Qm9vbGVhbn0gZnVsbFNjcmVlblxuQHByb3BlcnR5IHtCb29sZWFufSBwYXVzZWRcbkBwcm9wZXJ0eSB7Q29udGV4dH0gY29udGV4dFxuQHByb3BlcnR5IHtJbnR9IHdpZHRoXG5AcHJvcGVydHkge0ludH0gaGVpZ3RoXG5AcHJvcGVydHkge0RPTUVsZW1lbnR9IHJlbmRlcmVyXG5cbkBleGFtcGxlIEhvdyB0byBjcmVhdGUgYW4gZ2FtZSBjb3JlIFxuICAgIGdjID0gbmV3IEdhbWVDb3JlKCkgIyBDcmVhdGluZyBjb3JlXG4gICAgZ2MucmVuZGVyZXIgPSBkb2N1bWVudC5ib2R5ICMgQXBwZW5kcyBuZXcgY2FudmFzIGVsZW1lbnQgdG8gZG9jdW1lbnRzIGJvZHlcblxuQGV4YW1wbGUgTWFraW5nIGNhbnZhcyBmdWxsLXNpemVkXG4gICAgZ2MgPSBuZXcgR2FtZUNvcmUoKSAjIENyZWF0aW5nIGNvcmVcbiAgICBnYy5mdWxsU2NyZWVuID0gdHJ1ZVxuKi9cblxuXG5HYW1lQ29yZSA9IChmdW5jdGlvbigpIHtcbiAgLypcbiAgR2FtZUNvcmUgaW5zdGFuY2VjIGFyY2hpdmVcbiAgKi9cblxuICBHYW1lQ29yZS5jb3JlcyA9IHt9O1xuXG4gIC8qXG4gIFN0YXJ0IHlvdXIgYXBwbGljYXRpb24gZnJvbSBoZXJlLlxuICBcbiAgQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgKi9cblxuXG4gIGZ1bmN0aW9uIEdhbWVDb3JlKG9wdGlvbnMpIHtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zIDoge307XG4gICAgLypcbiAgICBJbiB0aGUgZmlyc3QgY2FzZSB3ZSBuZWVkIHRvIGdlbmVyYXRlIGlkIGZvciBuZXcgaW5zdGFuY2UsIGlmIGl0IG5vdFxuICAgICBwcmVzZW50IGluIG9wdGlvbnMuXG4gICAgKi9cblxuICAgIHRoaXMuaWQgPSB0aGlzLm9wdGlvbnMuaWQgfHwgVVVJRC5nZW5lcmF0ZVVuaXF1ZUlkKCk7XG4gICAgLypcbiAgICBTZXR0aW5nIHVwIGEgY2FudmFzLlxuICAgIElmIGNhbnZhcyBkb2Vzbid0IHByZXNlbnQgaW4gb3B0aW9ucyB0aGVuIGNyZWF0ZSBpdC5cbiAgICAqL1xuXG4gICAgdGhpcy5vcHRpb25zLmNhbnZhcyA9IHRoaXMub3B0aW9ucy5jYW52YXMgfHwgdGhpcy5jcmVhdGVDYW52YXMoKTtcbiAgICAvKlxuICAgIFJlZ2lzdHJhdGluZyBHYW1lQ29yZSBpbnN0YW5jZSBpbiBjYW52YXMgYW5nIEdhbWVDb3JlIGdsb2JhbC5cbiAgICAqL1xuXG4gICAgdGhpcy5vcHRpb25zLmNhbnZhcy5jb3JlID0gdGhpcztcbiAgICBHYW1lQ29yZS5jb3Jlc1t0aGlzLmlkXSA9IHRoaXM7XG4gICAgLypcbiAgICBTZXR0aW5nIHVwIGZyYW1lcmF0ZVxuICAgICovXG5cbiAgICB0aGlzLnNldEZyYW1lcmF0ZSgpO1xuICAgIHRoaXMuX2ZyYW1lID0gMDtcbiAgICAvKlxuICAgIFN0YWdlcyBtYXBcbiAgICAqL1xuXG4gICAgdGhpcy5fc3RhZ2VzID0ge307XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhZ2VcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YWdlO1xuICAgICAgICBpZiAodGhpcy5fY3VycmVudF9zdGFnZV9pZCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFnZXNbdGhpcy5fY3VycmVudF9zdGFnZV9pZF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RhZ2UgPSBuZXcgU3RhZ2U7XG4gICAgICAgICAgdGhpcy5fY3VycmVudF9zdGFnZV9pZCA9IHN0YWdlLmlkO1xuICAgICAgICAgIHRoaXMuYWRkU3RhZ2Uoc3RhZ2UpO1xuICAgICAgICAgIHJldHVybiBzdGFnZTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24oc3RhZ2UpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9zdGFnZXNbc3RhZ2UuaWRdKSB7XG4gICAgICAgICAgdGhpcy5hZGRTdGFnZShzdGFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRfc3RhZ2VfaWQgPSBzdGFnZS5pZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvKlxuICAgICovXG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJmdWxsU2NyZWVuXCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbl90aGVfZnVsbHNjcmVlbl9ub3c7XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbihiKSB7XG4gICAgICAgIGlmIChiID09PSB0cnVlKSB7XG4gICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5fZnVsbFNjcmVlbl9yZXNpemVyKTtcbiAgICAgICAgICB0aGlzLl9pbl90aGVfZnVsbHNjcmVlbl9ub3cgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiB0aGlzLnNldFNpemUoZG9jdW1lbnQud2lkdGgsIGRvY3VtZW50LmhlaWdodCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5fZnVsbFNjcmVlbl9yZXNpemVyKTtcbiAgICAgICAgICB0aGlzLl9pbl90aGVfZnVsbHNjcmVlbl9ub3cgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zZXRTaXplKHRoaXMub3B0aW9ucy53aWR0aCwgdGhpcy5vcHRpb25zLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmZ1bGxTY3JlZW4gPSB0aGlzLm9wdGlvbnMuZnVsbFNjcmVlbjtcbiAgICAvKlxuICAgICovXG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJ3aWR0aFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNhbnZhcy53aWR0aDtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHdpZHRoKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5jYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5jYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvKlxuICAgICovXG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJoZWlnaHRcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5jYW52YXMuaGVpZ2h0O1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24oaGVpZ2h0KSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNhbnZhcy5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyBcInB4XCI7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHRoaXMuZnVsbFNjcmVlbikge1xuICAgICAgdGhpcy5vcHRpb25zLndpZHRoID0gd2luZG93LndpZHRoO1xuICAgICAgdGhpcy5vcHRpb25zLmhlaWdodCA9IHdpbmRvdy5oZWlnaHQ7XG4gICAgfVxuICAgIHRoaXMuc2V0U2l6ZSh0aGlzLm9wdGlvbnMud2lkdGgsIHRoaXMub3B0aW9ucy5oZWlnaHQpO1xuICAgIC8qXG4gICAgQ29udGV4dCBlbGVtZW50LlxuICAgIEN1cnJlbnRseSBzdXBwb3J0IG9ubHkgQ29udGV4dDJkXG4gICAgKi9cblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbnRleHRcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9jb250ZXh0KSB7XG4gICAgICAgICAgdGhpcy5fY29udGV4dCA9IG5ldyBjb250ZXh0MmQoe1xuICAgICAgICAgICAgY2FudmFzOiB0aGlzLm9wdGlvbnMuY2FudmFzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQ7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLypcbiAgICAqL1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicGF1c2VkXCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXVzZWQgfHwgZmFsc2U7XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbihwYXVzZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhdXNlZCA9IHBhdXNlZCA/IHRydWUgOiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvKlxuICAgIFJlbmRlcmVyIGVsZW1lbnQuXG4gICAgKi9cblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlbmRlcmVyXCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnRfbm9kZSB8fCAndW5kZWZpbmVkJztcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgaWYgKCFub2RlLnRhZ05hbWUpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcIkNhbiByZW5kZXIgb25seSBvbiBkb2N1bWVudCBlbGVtZW50c1wiKTtcbiAgICAgICAgfVxuICAgICAgICBub2RlLmFwcGVuZENoaWxkKHRoaXMub3B0aW9ucy5jYW52YXMpO1xuICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50X25vZGUgPSBub2RlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuX29uRW50ZXJGcmFtZSgpO1xuICB9XG5cbiAgLypcbiAgKi9cblxuXG4gIEdhbWVDb3JlLnByb3RvdHlwZS5hZGRTdGFnZSA9IGZ1bmN0aW9uKHN0YWdlLCBzZXRDdXJyZW50KSB7XG4gICAgaWYgKHNldEN1cnJlbnQgPT0gbnVsbCkge1xuICAgICAgc2V0Q3VycmVudCA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLl9zdGFnZXNbc3RhZ2UuaWRdID0gc3RhZ2U7XG4gICAgaWYgKHNldEN1cnJlbnQpIHtcbiAgICAgIHJldHVybiB0aGlzLnN0YWdlID0gc3RhZ2UuaWQ7XG4gICAgfVxuICB9O1xuXG4gIC8qXG4gIFN3aXRjaCBwYXVzZSBzdGF0ZVxuICAqL1xuXG5cbiAgR2FtZUNvcmUucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucGF1c2VkID0gIXRoaXMucGF1c2VkO1xuICB9O1xuXG4gIC8qXG4gIFNldCdzIGZyYW1lcmF0ZS4gTm90IHVzYWJsZSBhdCB0aGUgbW9tZW50Li4uXG4gIEBwYXJhbSB7SW50fSBmcmFtZXJhdGVcbiAgQG1ldGhvZCBzZXRGcmFtZXJhdGVcbiAgKi9cblxuXG4gIEdhbWVDb3JlLnByb3RvdHlwZS5zZXRGcmFtZXJhdGUgPSBmdW5jdGlvbihmcmFtZXJhdGUpIHtcbiAgICBpZiAoZnJhbWVyYXRlID09IG51bGwpIHtcbiAgICAgIGZyYW1lcmF0ZSA9IDYwO1xuICAgIH1cbiAgICByZXR1cm4gd2luZG93Ll9GUFMgPSBmcmFtZXJhdGU7XG4gIH07XG5cbiAgLypcbiAgU2V0IHNpemUgb2YgYW4gY2FudmFzIGVsZW1lbnQuXG4gIEBwYXJhbSB7SW50fSB3aWR0aFxuICBAcGFyYW0ge0ludH0gaGVpZ2h0XG4gIEBtZXRob2Qgc2V0U2l6ZVxuICAqL1xuXG5cbiAgR2FtZUNvcmUucHJvdG90eXBlLnNldFNpemUgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7XG4gICAgaWYgKHdpZHRoID09IG51bGwpIHtcbiAgICAgIHdpZHRoID0gNDAwO1xuICAgIH1cbiAgICBpZiAoaGVpZ2h0ID09IG51bGwpIHtcbiAgICAgIGhlaWdodCA9IDMwMDtcbiAgICB9XG4gICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgIHJldHVybiB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgfTtcblxuICBHYW1lQ29yZS5wcm90b3R5cGUuX2Z1bGxTY3JlZW5fcmVzaXplciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBnY2k7XG4gICAgZ2NpID0gdGhpcztcbiAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgcmV0dXJuIGdjaS5zZXRTaXplKHdpbmRvdy53aWR0aCwgd2luZG93LmhlaWdodCk7XG4gICAgfTtcbiAgfTtcblxuICAvKlxuICBDcmVhdGVzIGEgY2FudmFzIGVsZW1lbnRcbiAgQG1ldGhvZCBjcmVhdGVDYW52YXNcbiAgKi9cblxuXG4gIEdhbWVDb3JlLnByb3RvdHlwZS5jcmVhdGVDYW52YXMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgY2FudmFzO1xuICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIHJldHVybiBjYW52YXM7XG4gIH07XG5cbiAgLypcbiAgQ2FsbCB3aW5kb3cncyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUuXG4gIEBtZXRob2QgX29uRW50ZXJGcmFtZVxuICAqL1xuXG5cbiAgR2FtZUNvcmUucHJvdG90eXBlLl9vbkVudGVyRnJhbWUgPSBmdW5jdGlvbihnY2kpIHtcbiAgICBpZiAoZ2NpID09IG51bGwpIHtcbiAgICAgIGdjaSA9IHRoaXM7XG4gICAgfVxuICAgIGlmICghdGhpcy5wYXVzZWQpIHtcbiAgICAgIGdjaS5fcmVuZGVyKGdjaS5zdGFnZSk7XG4gICAgfVxuICAgIHJldHVybiB3aW5kb3cub25FbnRlckZyYW1lKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGdjaS5fb25FbnRlckZyYW1lKGdjaSk7XG4gICAgfSk7XG4gIH07XG5cbiAgR2FtZUNvcmUucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9mcmFtZSsrO1xuICAgIHJldHVybiB0aGlzLmNvbnRleHQucmVuZGVyKFt0aGlzLnN0YWdlXSk7XG4gIH07XG5cbiAgcmV0dXJuIEdhbWVDb3JlO1xuXG59KSgpO1xuXG53aW5kb3cuR2FtZUNvcmUgPSB3aW5kb3cuR2FtZUNvcmUgfHwgR2FtZUNvcmU7XG5cbkdhbWVDb3JlLmV4cG9ydHMgPSB7XG4gIFVJOiByZXF1aXJlKFwiLi91aS9leHBvcnRzXCIpLFxuICBNYXRoOiByZXF1aXJlKFwiLi9tYXRoL2V4cG9ydHNcIilcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZUNvcmU7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD1jb3JlLm1hcFxuKi9cblxufSkoKSIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBDb250ZXh0MmQ7XG5cbkNvbnRleHQyZCA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gQ29udGV4dDJkKG9wdGlvbnMpIHtcbiAgICB0aGlzLnNldENhbnZhcyhvcHRpb25zLmNhbnZhcyk7XG4gIH1cblxuICBDb250ZXh0MmQucHJvdG90eXBlLnNldENhbnZhcyA9IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBDb250ZXh0MmQucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY3R4LmNhbnZhcy53aWR0aCwgdGhpcy5jdHguY2FudmFzLmhlaWdodCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgQ29udGV4dDJkLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihsYXllcnMpIHtcbiAgICB2YXIgbGF5ZXIsIF9pLCBfbGVuLCBfcmVzdWx0cztcbiAgICBpZiAobGF5ZXJzID09IG51bGwpIHtcbiAgICAgIGxheWVycyA9IFtdO1xuICAgIH1cbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGxheWVycy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgbGF5ZXIgPSBsYXllcnNbX2ldO1xuICAgICAgX3Jlc3VsdHMucHVzaChsYXllci5yZW5kZXIodGhpcy5jdHgpKTtcbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIHJldHVybiBDb250ZXh0MmQ7XG5cbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gQ29udGV4dDJkO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9MmQubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIGJyb3dzZXJQcmVmaXgsIHByZWZpeCwgdXNlckFnZW50O1xuXG5wcmVmaXggPSBmdW5jdGlvbihuYW1lKSB7XG4gIGlmIChicm93c2VyUHJlZml4ICE9PSBcIlwiKSB7XG4gICAgbmFtZSA9IG5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpO1xuICB9XG4gIHJldHVybiBicm93c2VyUHJlZml4ICsgbmFtZTtcbn07XG5cbnVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG5cbmJyb3dzZXJQcmVmaXggPSAodXNlckFnZW50Lm1hdGNoKC9vcGVyYS9pKSAmJiBcIm9cIikgfHwgKHVzZXJBZ2VudC5tYXRjaCgvd2Via2l0L2kpICYmIFwid2Via2l0XCIpIHx8ICh1c2VyQWdlbnQubWF0Y2goL21zaWUvaSkgJiYgXCJtc1wiKSB8fCAodXNlckFnZW50Lm1hdGNoKC9tb3ppbGxhL2kpICYmIFwibW96XCIpIHx8IFwiXCI7XG5cbkZ1bmN0aW9uLnByb3RvdHlwZS5wcm9wZXJ0eSA9IGZ1bmN0aW9uKHByb3AsIGRlc2MpIHtcbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLnByb3RvdHlwZSwgcHJvcCwgZGVzYyk7XG59O1xuXG5pZiAodHlwZW9mIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgSFRNTEVsZW1lbnQucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBjYWxsYmFjaywgdXNlQ2FwdHVyZSkge1xuICAgIHJldHVybiBhdHRhY2hFdmVudChcIm9uXCIgKyB0eXBlLCBjYWxsYmFjayk7XG4gIH07XG59XG5cbi8qXG53aW5kb3cub25FbnRlckZyYW1lXG4qL1xuXG5cbndpbmRvdy5vbkVudGVyRnJhbWUgPSAoZnVuY3Rpb24oKSB7XG4gIHJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICByZXR1cm4gd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyB3aW5kb3cuX0ZQUyk7XG4gIH07XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgLypcbiAgQnJvd3NlcidzIHVzZXItYWdlbnQgc3RyaW5nXG4gIEBhdHRyaWJ1dGUgdXNlckFnZW50XG4gIEB0eXBlIHtTdHJpbmd9XG4gIEBzdGF0aWNcbiAgQHJlYWRvbmx5XG4gICovXG5cbiAgdXNlckFnZW50OiB1c2VyQWdlbnQsXG4gIC8qXG4gIERldmljZSBzdXBwb3J0cyB0b3VjaCBldmVudHM/XG4gIEBhdHRyaWJ1dGUgdG91Y2hcbiAgQHR5cGUge0Jvb2xlYW59XG4gIEBzdGF0aWNcbiAgQHJlYWRvbmx5XG4gICovXG5cbiAgdG91Y2g6IFwib250b3VjaHN0YXJ0XCIgaW4gd2luZG93LFxuICAvKlxuICBEZXZpY2Ugc3VwcG9ydHMgUmV0aW5hIERpc3BsYXk/XG4gIEBhdHRyaWJ1dGUgcmV0aW5hXG4gIEB0eXBlIHtCb29sZWFufVxuICBAc3RhdGljXG4gIEByZWFkb25seVxuICAqL1xuXG4gIHJldGluYTogd2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxIHx8IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1pbi1yZXNvbHV0aW9uOiAxLjFkcHB4KVwiKS5tYXRjaGVzLFxuICBpbWFnZVNtb290aGluZ0VuYWJsZWQ6IHByZWZpeChcImltYWdlU21vb3RoaW5nRW5hYmxlZFwiKVxufTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPXN1cHBvcnQubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIE1hdHJpeDJEOiByZXF1aXJlKFwiLi9tYXRyaXgyZFwiKSxcbiAgVmVjdG9yMkQ6IHJlcXVpcmUoXCIuL3ZlY3RvcjJkXCIpLFxuICBVVUlEOiByZXF1aXJlKFwiLi91dWlkXCIpXG59O1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9ZXhwb3J0cy5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgTWF0cml4MkQ7XG5cbk1hdHJpeDJEID0gKGZ1bmN0aW9uKCkge1xuICAvKlxuICBCYXNlZCBvbiBbRWFzZWxKU10oaHR0cHM6Ly9naXRodWIuY29tL0NyZWF0ZUpTL0Vhc2VsSlMvKSBNYXRyaXgyRCBpbXBsZW1lbnRhdGlvbi5cbiAgXG4gIEBjbGFzcyBNYXRyaXgyRFxuICBAY29uc3RydWN0b3JcbiAgXG4gIEBwYXJhbSB7TnVtYmVyfSBtMTFcbiAgQHBhcmFtIHtOdW1iZXJ9IG0xMlxuICBAcGFyYW0ge051bWJlcn0gbTIxXG4gIEBwYXJhbSB7TnVtYmVyfSBtMjJcbiAgQHBhcmFtIHtOdW1iZXJ9IGR4XG4gIEBwYXJhbSB7TnVtYmVyfSBkeVxuICAqL1xuXG4gIGZ1bmN0aW9uIE1hdHJpeDJEKG0xMSwgbTEyLCBtMjEsIG0yMiwgZHgsIGR5KSB7XG4gICAgaWYgKG0xMSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5tMTEgPSBtMTE7XG4gICAgfVxuICAgIHRoaXMubTEyID0gbTEyIHx8IDA7XG4gICAgdGhpcy5tMjEgPSBtMjEgfHwgMDtcbiAgICBpZiAobTIyICE9PSBudWxsKSB7XG4gICAgICB0aGlzLm0yMiA9IG0yMjtcbiAgICB9XG4gICAgdGhpcy5keCA9IGR4IHx8IDA7XG4gICAgdGhpcy5keSA9IGR5IHx8IDA7XG4gIH1cblxuICAvKlxuICBHZW5lcmF0ZXMgbWF0cml4IHByb3BlcnRpZXMgZnJvbSB0aGUgc3BlY2lmaWVkIGRpc3BsYXkgb2JqZWN0IHRyYW5zZm9ybSBwcm9wZXJ0aWVzLCBhbmQgYXBwZW5kcyB0aGVtIHdpdGggdGhpcyBtYXRyaXguXG4gIEZvciBleGFtcGxlLCB5b3UgY2FuIHVzZSB0aGlzIHRvIGdlbmVyYXRlIG0xMSBtYXRyaXggZnJvbSBtMTEgZGlzcGxheSBvYmplY3Q6IHZhciBtdHggPSBuZXcgTWF0cml4MkQoKTtcbiAgbXR4LmFwcGVuZFRyYW5zZm9ybShvLngsIG8ueSwgby5zY2FsZVgsIG8uc2NhbGVZLCBvLnJvdGF0aW9uKTtcbiAgQG1ldGhvZCBhcHBlbmRUcmFuc2Zvcm1cbiAgQHBhcmFtIHtOdW1iZXJ9IHhcbiAgQHBhcmFtIHtOdW1iZXJ9IHlcbiAgQHBhcmFtIHtOdW1iZXJ9IHNjYWxlWFxuICBAcGFyYW0ge051bWJlcn0gc2NhbGVZXG4gIEBwYXJhbSB7TnVtYmVyfSByb3RhdGlvblxuICBAcGFyYW0ge051bWJlcn0gc2tld1hcbiAgQHBhcmFtIHtOdW1iZXJ9IHNrZXdZXG4gIEBwYXJhbSB7TnVtYmVyfSBwaXZvdFggT3B0aW9uYWwuXG4gIEBwYXJhbSB7TnVtYmVyfSBwaXZvdFkgT3B0aW9uYWwuXG4gIEByZXR1cm4ge01hdHJpeDJEfSBUaGlzIG1hdHJpeC4gVXNlZnVsIGZvciBjaGFpbmluZyBtZXRob2QgY2FsbHMuXG4gICovXG5cblxuICBNYXRyaXgyRC5wcm90b3R5cGUuYXBwZW5kVHJhbnNmb3JtID0gZnVuY3Rpb24oeCwgeSwgc2NhbGVYLCBzY2FsZVksIHJvdGF0aW9uLCBza2V3WCwgc2tld1ksIHBpdm90WCwgcGl2b3RZKSB7XG4gICAgdmFyIGNvcywgciwgc2luO1xuICAgIGNvcyA9IHZvaWQgMDtcbiAgICBzaW4gPSB2b2lkIDA7XG4gICAgciA9IHZvaWQgMDtcbiAgICBpZiAocm90YXRpb24gJSAzNjApIHtcbiAgICAgIHIgPSByb3RhdGlvbiAqIE1hdHJpeDJELkRFR19UT19SQUQ7XG4gICAgICBjb3MgPSBNYXRoLmNvcyhyKTtcbiAgICAgIHNpbiA9IE1hdGguc2luKHIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb3MgPSAxO1xuICAgICAgc2luID0gMDtcbiAgICB9XG4gICAgaWYgKHNrZXdYIHx8IHNrZXdZKSB7XG4gICAgICBza2V3WCAqPSBNYXRyaXgyRC5ERUdfVE9fUkFEO1xuICAgICAgc2tld1kgKj0gTWF0cml4MkQuREVHX1RPX1JBRDtcbiAgICAgIHRoaXMuYXBwZW5kKE1hdGguY29zKHNrZXdZKSwgTWF0aC5zaW4oc2tld1kpLCAtTWF0aC5zaW4oc2tld1gpLCBNYXRoLmNvcyhza2V3WCksIHgsIHkpO1xuICAgICAgdGhpcy5hcHBlbmQoY29zICogc2NhbGVYLCBzaW4gKiBzY2FsZVgsIC1zaW4gKiBzY2FsZVksIGNvcyAqIHNjYWxlWSwgMCwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXBwZW5kKGNvcyAqIHNjYWxlWCwgc2luICogc2NhbGVYLCAtc2luICogc2NhbGVZLCBjb3MgKiBzY2FsZVksIHgsIHkpO1xuICAgIH1cbiAgICBpZiAocGl2b3RYIHx8IHBpdm90WSkge1xuICAgICAgdGhpcy5keCAtPSBwaXZvdFggKiB0aGlzLm0xMSArIHBpdm90WSAqIHRoaXMubTIxO1xuICAgICAgdGhpcy5keSAtPSBwaXZvdFggKiB0aGlzLm0xMiArIHBpdm90WSAqIHRoaXMubTIyO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKlxuICBBcHBlbmRzIHRoZSBzcGVjaWZpZWQgbWF0cml4IHByb3BlcnRpZXMgd2l0aCB0aGlzIG1hdHJpeC4gQWxsIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkLlxuICBAbWV0aG9kIGFwcGVuZFxuICBAcGFyYW0ge051bWJlcn0gbTExXG4gIEBwYXJhbSB7TnVtYmVyfSBtMTJcbiAgQHBhcmFtIHtOdW1iZXJ9IG0yMVxuICBAcGFyYW0ge051bWJlcn0gbTIyXG4gIEBwYXJhbSB7TnVtYmVyfSBkeFxuICBAcGFyYW0ge051bWJlcn0gZHlcbiAgQHJldHVybiB7TWF0cml4MkR9IFRoaXMgbWF0cml4LiBVc2VmdWwgZm9yIGNoYWluaW5nIG1ldGhvZCBjYWxscy5cbiAgKi9cblxuXG4gIE1hdHJpeDJELnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbihtMTEsIG0xMiwgbTIxLCBtMjIsIGR4LCBkeSkge1xuICAgIHZhciBhMSwgYjEsIGMxLCBkMTtcbiAgICBhMSA9IHRoaXMubTExO1xuICAgIGIxID0gdGhpcy5tMTI7XG4gICAgYzEgPSB0aGlzLm0yMTtcbiAgICBkMSA9IHRoaXMubTIyO1xuICAgIHRoaXMubTExID0gbTExICogYTEgKyBtMTIgKiBjMTtcbiAgICB0aGlzLm0xMiA9IG0xMSAqIGIxICsgbTEyICogZDE7XG4gICAgdGhpcy5tMjEgPSBtMjEgKiBhMSArIG0yMiAqIGMxO1xuICAgIHRoaXMubTIyID0gbTIxICogYjEgKyBtMjIgKiBkMTtcbiAgICB0aGlzLmR4ID0gZHggKiBhMSArIGR5ICogYzEgKyB0aGlzLmR4O1xuICAgIHRoaXMuZHkgPSBkeCAqIGIxICsgZHkgKiBkMSArIHRoaXMuZHk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLypcbiAgSW52ZXJ0cyB0aGUgbWF0cml4LCBjYXVzaW5nIGl0IHRvIHBlcmZvcm0gdGhlIG9wcG9zaXRlIHRyYW5zZm9ybWF0aW9uLlxuICBAbWV0aG9kIGludmVydFxuICBAcmV0dXJuIHtNYXRyaXgyRH0gdGhpc1xuICAqL1xuXG5cbiAgTWF0cml4MkQucHJvdG90eXBlLmludmVydCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBhMSwgYjEsIGMxLCBkMSwgbiwgdHgxO1xuICAgIGExID0gdGhpcy5tMTE7XG4gICAgYjEgPSB0aGlzLm0xMjtcbiAgICBjMSA9IHRoaXMubTIxO1xuICAgIGQxID0gdGhpcy5tMjI7XG4gICAgdHgxID0gdGhpcy5keDtcbiAgICBuID0gYTEgKiBkMSAtIGIxICogYzE7XG4gICAgdGhpcy5tMTEgPSBkMSAvIG47XG4gICAgdGhpcy5tMTIgPSAtYjEgLyBuO1xuICAgIHRoaXMubTIxID0gLWMxIC8gbjtcbiAgICB0aGlzLm0yMiA9IGExIC8gbjtcbiAgICB0aGlzLmR4ID0gKGMxICogdGhpcy5keSAtIGQxICogdHgxKSAvIG47XG4gICAgdGhpcy5keSA9IC0oYTEgKiB0aGlzLmR5IC0gYjEgKiB0eDEpIC8gbjtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKlxuICBDbG9uZSBNYXRyaXgyRCBpbnN0YW5jZVxuICBAcmV0dXJuIHtNYXRyaXgyRH1cbiAgKi9cblxuXG4gIE1hdHJpeDJELnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgTWF0cml4MkQodGhpcy5tMTEsIHRoaXMubTEyLCB0aGlzLm0yMSwgdGhpcy5tMjIsIHRoaXMuZHgsIHRoaXMuZHkpO1xuICB9O1xuXG4gIC8qXG4gIFJlc2V0IG1hdHJpeCB0byBpdCdzIGlkZW50aXR5XG4gIEByZXR1cm4ge01hdHJpeDJEfSB0aGlzXG4gICovXG5cblxuICBNYXRyaXgyRC5wcm90b3R5cGUuaWRlbnRpdHkgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm0xMSA9IHRoaXMubTIyID0gMTtcbiAgICB0aGlzLm0xMiA9IHRoaXMubTIxID0gdGhpcy5keCA9IHRoaXMuZHkgPSAwO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qICAgICAgICAgICBcbiAgTXVsdGlwbGllciBmb3IgY29udmVydGluZyBkZWdyZWVzIHRvIHJhZGlhbnMuIFVzZWQgaW50ZXJuYWxseSBieSBNYXRyaXgyRC5cbiAgXG4gIEBhdHRyaWJ1dGUgREVHX1RPX1JBRFxuICBAc3RhdGljXG4gIEByZWFkb25seVxuICBAcmV0dXJuIHtOdW1iZXJ9XG4gICovXG5cblxuICBNYXRyaXgyRC5ERUdfVE9fUkFEID0gTWF0aC5QSSAvIDE4MDtcblxuICBNYXRyaXgyRC5pZGVudGl0eSA9IG5ldyBNYXRyaXgyRCgxLCAwLCAwLCAxLCAwLCAwKTtcblxuICByZXR1cm4gTWF0cml4MkQ7XG5cbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gTWF0cml4MkQ7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD1tYXRyaXgyZC5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgVVVJRDtcblxuVVVJRCA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gVVVJRCgpIHt9XG5cbiAgLypcbiAgQG1ldGhvZCBnZW5lcmF0ZVVuaXF1ZUlkXG4gIEByZXR1cm4ge1N0cmluZ31cbiAgKi9cblxuXG4gIFVVSUQuZ2VuZXJhdGVVbmlxdWVJZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBcImdjLVwiICsgdGhpcy51dWlkKCk7XG4gIH07XG5cbiAgLypcbiAgQG1ldGhvZCB1dWlkXG4gIEByZXR1cm4ge1N0cmluZ31cbiAgKi9cblxuXG4gIFVVSUQudXVpZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uKGMpIHtcbiAgICAgIHZhciByLCB2O1xuICAgICAgciA9IE1hdGgucmFuZG9tKCkgKiAxNiB8IDA7XG4gICAgICB2ID0gYyA9PT0gJ3gnID8gciA6IHIgJiAweDMgfCAweDg7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIFVVSUQ7XG5cbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gVVVJRDtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPXV1aWQubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIFZlY3RvcjJkO1xuXG5WZWN0b3IyZCA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gVmVjdG9yMmQoeCwgeSkge1xuICAgIHRoaXMueCA9IHggIT0gbnVsbCA/IHggOiAwO1xuICAgIHRoaXMueSA9IHkgIT0gbnVsbCA/IHkgOiAwO1xuICAgIC8qXG4gICAgR2V0IHRoZSBtYWduaXR1ZGUgb2YgdGhpcyB2ZWN0b3JcbiAgICBAYXR0cmlidXRlIGxlbmd0aFxuICAgIEByZWFkb25seVxuICAgICovXG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJsZW5ndGhcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydCgodGhpcy54ICogdGhpcy54KSArICh0aGlzLnkgKiB0aGlzLnkpKTtcbiAgICAgIH0sXG4gICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICAvKlxuICAgIEdldCB0aGlzIHZlY3RvciB3aXRoIGEgbWFnbml0dWRlIG9mIDEuXG4gICAgQGF0dHJpYnV0ZSBub3JtYWxpemVkXG4gICAgQHJlYWRvbmx5XG4gICAgKi9cblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5vcm1hbGl6ZWRcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1hZ25pdHVkZTtcbiAgICAgICAgbWFnbml0dWRlID0gdGhpcy5sZW5ndGg7XG4gICAgICAgIHJldHVybiBuZXcgVmVjdG9yMmQodGhpcy54IC8gbWFnbml0dWRlLCB0aGlzLnkgLyBtYWduaXR1ZGUpO1xuICAgICAgfSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgQG1ldGhvZCBzZXRcbiAgQHBhcmFtIHtOdW1iZXJ9IHhcbiAgQHBhcmFtIHtOdW1iZXJ9IHlcbiAgQHJldHVybiB7VmVjdG9yMmR9XG4gICovXG5cblxuICBWZWN0b3IyZC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24oeCwgeSkge1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgfTtcblxuICAvKlxuICBAbWV0aG9kIHN1bVxuICBAcGFyYW0ge1ZlY3RvcjJkfSB2ZWN0b3IyZFxuICBAcmV0dXJuIHtWZWN0b3IyZH1cbiAgKi9cblxuXG4gIFZlY3RvcjJkLnByb3RvdHlwZS5zdWJ0cmFjdCA9IGZ1bmN0aW9uKHZlY3RvcjJkKSB7XG4gICAgdGhpcy54IC09IHZlY3RvcjJkLng7XG4gICAgcmV0dXJuIHRoaXMueSAtPSB2ZWN0b3IyZC55O1xuICB9O1xuXG4gIC8qXG4gIEBtZXRob2Qgc3VtXG4gIEBwYXJhbSB7VmVjdG9yMmR9IHZlY3RvcjJkXG4gIEByZXR1cm4ge1ZlY3RvcjJkfVxuICAqL1xuXG5cbiAgVmVjdG9yMmQucHJvdG90eXBlLnN1bSA9IGZ1bmN0aW9uKHZlY3RvcjJkKSB7XG4gICAgdGhpcy54ICs9IHZlY3RvcjJkLng7XG4gICAgcmV0dXJuIHRoaXMueSArPSB2ZWN0b3IyZC55O1xuICB9O1xuXG4gIC8qXG4gIEBtZXRob2Qgc2NhbGVcbiAgQHBhcmFtIHtOdW1iZXJ9IHggKG9yIHggeSlcbiAgQHBhcmFtIHtOdW1iZXJ9IHlcbiAgQHJldHVybiB7VmVjdG9yMmR9XG4gICovXG5cblxuICBWZWN0b3IyZC5wcm90b3R5cGUuc2NhbGUgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgdGhpcy54ICo9IHg7XG4gICAgcmV0dXJuIHRoaXMueSAqPSB5IHx8IHg7XG4gIH07XG5cbiAgLypcbiAgQG1ldGhvZCBjbG9uZVxuICBAcmV0dXJuIHtWZWN0b3IyZH1cbiAgKi9cblxuXG4gIFZlY3RvcjJkLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVmVjdG9yMmQodGhpcy54LCB0aGlzLnkpO1xuICB9O1xuXG4gIC8qXG4gIFJldHVybiB1bml0IHZlY3RvclxuICBAcmV0dXJuIHtWZWN0b3IyZH1cbiAgKi9cblxuXG4gIFZlY3RvcjJkLnByb3RvdHlwZS51bml0ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBWZWN0b3IyZChNYXRoLmNvcyh0aGlzLngpLCBNYXRoLnNpbih0aGlzLnkpKTtcbiAgfTtcblxuICAvKlxuICBOb3JtYWxpemUgdGhpcyB2ZWN0b3JcbiAgQHJldHVybiB7VmVjdG9yMmR9XG4gICovXG5cblxuICBWZWN0b3IyZC5wcm90b3R5cGUubm9ybWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vcm1hbDtcbiAgICBub3JtYWwgPSB0aGlzLm5vcm1hbGl6ZWQ7XG4gICAgdGhpcy54ID0gbm9ybWFsLng7XG4gICAgcmV0dXJuIHRoaXMueSA9IG5vcm1hbC55O1xuICB9O1xuXG4gIC8qXG4gIEdldCB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0aGlzIHZlY3RvciBhbmQgdGhlIGFyZ3VtZW50IHZlY3RvclxuICBAcGFyYW0ge1ZlY3RvcjJkfSB2ZWN0b3JcbiAgQHJldHVybiB7TnVtYmVyfVxuICAqL1xuXG5cbiAgVmVjdG9yMmQuZGlzdGFuY2UgPSBmdW5jdGlvbih2MSwgdjIpIHtcbiAgICB2YXIgeGRpZmYsIHlkaWZmO1xuICAgIHhkaWZmID0gdjEueCAtIHYyLng7XG4gICAgeWRpZmYgPSB2MS55IC0gdjIueTtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KHhkaWZmICogeGRpZmYgKyB5ZGlmZiAqIHlkaWZmKTtcbiAgfTtcblxuICAvKlxuICBAbWV0aG9kIHRvU3RyaW5nXG4gIEByZXR1cm4ge1N0cmluZ31cbiAgKi9cblxuXG4gIFZlY3RvcjJkLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBcIiM8VmVjdG9yMmQgQHg9XCIgKyB0aGlzLnggKyBcIiwgQHk9XCIgKyB0aGlzLnkgKyBcIj5cIjtcbiAgfTtcblxuICBWZWN0b3IyZC5MRUZUID0gbmV3IFZlY3RvcjJkKC0xLCAwKTtcblxuICBWZWN0b3IyZC5SSUdIVCA9IG5ldyBWZWN0b3IyZCgxLCAwKTtcblxuICBWZWN0b3IyZC5UT1AgPSBuZXcgVmVjdG9yMmQoMCwgLTEpO1xuXG4gIFZlY3RvcjJkLkJPVFRPTSA9IG5ldyBWZWN0b3IyZCgwLCAxKTtcblxuICByZXR1cm4gVmVjdG9yMmQ7XG5cbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gVmVjdG9yMmQ7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD12ZWN0b3IyZC5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgQ29udGFpbmVyLCBXaWRnZXQsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuV2lkZ2V0ID0gcmVxdWlyZShcIi4vd2lkZ2V0XCIpO1xuXG5Db250YWluZXIgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhDb250YWluZXIsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gQ29udGFpbmVyKG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIENvbnRhaW5lci5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB0aGlzLmNoaWxkcmVuID0ge307XG4gIH1cblxuICBDb250YWluZXIucHJvdG90eXBlLmFkZENoaWxkID0gZnVuY3Rpb24oY2hpbGQpIHtcbiAgICBpZiAoY2hpbGQucGFyZW50ID09PSAhdGhpcykge1xuICAgICAgcmV0dXJuIGNoaWxkLnBhcmVudCA9IHRoaXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuW2NoaWxkLmlkXSA9IGNoaWxkO1xuICAgIH1cbiAgfTtcblxuICBDb250YWluZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGN0eCkge1xuICAgIHZhciBjaGlsZCwgY2lkLCBfcmVmLCBfcmVzdWx0cztcbiAgICBDb250YWluZXIuX19zdXBlcl9fLnJlbmRlci5jYWxsKHRoaXMsIGN0eCk7XG4gICAgX3JlZiA9IHRoaXMuY2hpbGRyZW47XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICBmb3IgKGNpZCBpbiBfcmVmKSB7XG4gICAgICBjaGlsZCA9IF9yZWZbY2lkXTtcbiAgICAgIF9yZXN1bHRzLnB1c2goY2hpbGQucmVuZGVyKGN0eCkpO1xuICAgIH1cbiAgICByZXR1cm4gX3Jlc3VsdHM7XG4gIH07XG5cbiAgcmV0dXJuIENvbnRhaW5lcjtcblxufSkoV2lkZ2V0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBDb250YWluZXI7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD1jb250YWluZXIubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIFdpZGdldDogcmVxdWlyZShcIi4vd2lkZ2V0XCIpLFxuICBTdGFnZTogcmVxdWlyZShcIi4vc3RhZ2VcIiksXG4gIENvbnRhaW5lcjogcmVxdWlyZShcIi4vY29udGFpbmVyXCIpLFxuICBUZXh0OiByZXF1aXJlKFwiLi90ZXh0XCIpLFxuICBnZW9tZXRyeTogcmVxdWlyZShcIi4vZ2VvbWV0cnkvZXhwb3J0c1wiKVxufTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPWV4cG9ydHMubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIENpcmNsZSwgV2lkZ2V0LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbldpZGdldCA9IHJlcXVpcmUoXCIuLi93aWRnZXRcIik7XG5cbkNpcmNsZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKENpcmNsZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBDaXJjbGUob3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9XG4gICAgQ2lyY2xlLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICB9XG5cbiAgcmV0dXJuIENpcmNsZTtcblxufSkoV2lkZ2V0KTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPWNpcmNsZS5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgQ2lyY2xlOiByZXF1aXJlKFwiLi9jaXJjbGVcIiksXG4gIFJlY3Q6IHJlcXVpcmUoXCIuL3JlY3RcIilcbn07XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD1leHBvcnRzLm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBSZWN0LCBXaWRnZXQsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuV2lkZ2V0ID0gcmVxdWlyZShcIi4uL3dpZGdldFwiKTtcblxuUmVjdCA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKFJlY3QsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gUmVjdChvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICBSZWN0Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICB9XG5cbiAgcmV0dXJuIFJlY3Q7XG5cbn0pKFdpZGdldCk7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD1yZWN0Lm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBTdGFnZSwgY29udGFpbmVyLFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmNvbnRhaW5lciA9IHJlcXVpcmUoXCIuLi91aS9jb250YWluZXJcIik7XG5cblN0YWdlID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoU3RhZ2UsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gU3RhZ2Uob3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9XG4gICAgU3RhZ2UuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgdGhpcy54ID0gMDtcbiAgICB0aGlzLnkgPSAwO1xuICB9XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGN0eCkge1xuICAgIHRoaXMud2lkdGggPSBjdHguY2FudmFzLndpZHRoO1xuICAgIHRoaXMuaGVpZ2h0ID0gY3R4LmNhbnZhcy5oZWlnaHQ7XG4gICAgcmV0dXJuIFN0YWdlLl9fc3VwZXJfXy5yZW5kZXIuY2FsbCh0aGlzLCBjdHgpO1xuICB9O1xuXG4gIHJldHVybiBTdGFnZTtcblxufSkoY29udGFpbmVyKTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdGFnZTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPXN0YWdlLm1hcFxuKi9cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbnZhciBCQVNFTElORSwgREVGQVVMVF9BTElHTiwgREVGQVVMVF9CQVNFTElORSwgREVGQVVMVF9DT0xPUiwgREVGQVVMVF9GT05ULCBUZXh0LCBXaWRnZXQsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuV2lkZ2V0ID0gcmVxdWlyZShcIi4vd2lkZ2V0XCIpO1xuXG4vKlxuT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoaXMsIEJBU0VMSU5FXG5Ac3RhdGljXG4qL1xuXG5cbkJBU0VMSU5FID0ge1xuICAvKlxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkgdGhpcywgQkFTRUxJTkUuVE9QXG4gIEB0eXBlIHtTdHJpbmd9XG4gIEBzdGF0aWNcbiAgKi9cblxuICBUT1A6IFwidG9wXCIsXG4gIC8qXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB0aGlzLCBCQVNFTElORS5IQU5HSU5HXG4gIEB0eXBlIHtTdHJpbmd9XG4gIEBzdGF0aWNcbiAgKi9cblxuICBIQU5HSU5HOiBcImhhbmdpbmdcIixcbiAgLypcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoaXMsIEJBU0VMSU5FLk1JRERMRVxuICBAdHlwZSB7U3RyaW5nfVxuICBAc3RhdGljXG4gICovXG5cbiAgTUlERExFOiBcIm1pZGRsZVwiLFxuICAvKlxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkgdGhpcywgQkFTRUxJTkUuQUxQSEFCRVRJQ1xuICBAdHlwZSB7U3RyaW5nfVxuICBAc3RhdGljXG4gICovXG5cbiAgQUxQSEFCRVRJQzogXCJhbHBoYWJldGljXCIsXG4gIC8qXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB0aGlzLCBCQVNFTElORS5JREVPR1JBUEhJQ1xuICBAdHlwZSB7U3RyaW5nfVxuICBAc3RhdGljXG4gICovXG5cbiAgSURFT0dSQVBISUM6IFwiaWRlb2dyYXBoaWNcIixcbiAgLypcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoaXMsIEJBU0VMSU5FLkJPVFRPTVxuICBAdHlwZSB7U3RyaW5nfVxuICBAc3RhdGljXG4gICovXG5cbiAgQk9UVE9NOiBcImJvdHRvbVwiXG59O1xuXG5ERUZBVUxUX0ZPTlQgPSBcIk5vcm1hbCAxMnB4IFZlcmRhbmFcIjtcblxuREVGQVVMVF9DT0xPUiA9IFwiIzAwMDAwMFwiO1xuXG5ERUZBVUxUX0FMSUdOID0gXCJsZWZ0XCI7XG5cbkRFRkFVTFRfQkFTRUxJTkUgPSBCQVNFTElORS5UT1A7XG5cblRleHQgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhUZXh0LCBfc3VwZXIpO1xuXG4gIC8qXG4gIEBjbGFzcyBUZXh0XG4gIEBleHRlbmRzIERpc3BsYXlPYmplY3RcbiAgXG4gIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIGFueSBhdHRyaWJ1dGUgbWF5IGJlIGluaXRpYWxpemVkIGJ5IG9wdGlvblxuICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMudGV4dF0gZGVmYXVsdCAtIFwiXCJcbiAgQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmZvbnRdIGRlZmF1bHQgLSBcIk5vcm1hbCAxMnB4IFZlcmRhbmFcIlxuICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuYWxpZ25dIGRlZmF1bHQgLSBcImxlZnRcIlxuICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuYmFzZWxpbmVdIGRlZmF1bHQgLSBKb3kuVGV4dC5CQVNFTElORS5UT1BcbiAgQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmNvbG9yXSBkZWZhdWx0IC0gIzAwMDAwMFxuICBcbiAgQGNvbnN0cnVjdG9yXG4gICovXG5cblxuICBmdW5jdGlvbiBUZXh0KG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIFRleHQuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgLypcbiAgICBUZXh0IHRvIGJlIGRpc3BsYXllZFxuICAgIEBhdHRyaWJ1dGUgdGV4dFxuICAgIEBkZWZhdWx0IFwiXCJcbiAgICBAdHlwZSB7U3RyaW5nfVxuICAgICovXG5cbiAgICB0aGlzLnRleHQgPSBvcHRpb25zLnRleHQgfHwgXCJcIjtcbiAgICAvKlxuICAgIEZvbnQgZmFtaWx5IGFuZCBzaXplXG4gICAgQGF0dHJpYnV0ZSBmb250XG4gICAgQGRlZmF1bHQgXCJOb3JtYWwgMTJweCBWZXJkYW5hXCJcbiAgICBAdHlwZSB7U3RyaW5nfVxuICAgICovXG5cbiAgICB0aGlzLmZvbnQgPSBvcHRpb25zLmZvbnQgfHwgREVGQVVMVF9GT05UO1xuICAgIC8qXG4gICAgVGV4dCBob3Jpem9udGFsIGFsaWdubWVudFxuICAgIEBhdHRyaWJ1dGUgYWxpZ25cbiAgICBAZGVmYXVsdCBcImxlZnRcIlxuICAgIEB0eXBlIHtTdHJpbmd9XG4gICAgKi9cblxuICAgIHRoaXMuYWxpZ24gPSBvcHRpb25zLmFsaWduIHx8IERFRkFVTFRfQUxJR047XG4gICAgLypcbiAgICBUZXh0IHZlcnRpY2FsIGJhc2VsaW5lXG4gICAgQGF0dHJpYnV0ZSBiYXNlbGluZVxuICAgIEBkZWZhdWx0IEpveS5UZXh0LkJBU0VMSU5FLlRPUFxuICAgIEB0eXBlIHtTdHJpbmd9XG4gICAgKi9cblxuICAgIHRoaXMuYmFzZWxpbmUgPSBvcHRpb25zLmJhc2VsaW5lIHx8IERFRkFVTFRfQkFTRUxJTkU7XG4gICAgLypcbiAgICBDb2xvciBvZiB0aGUgdGV4dFxuICAgIEBhdHRyaWJ1dGUgY29sb3JcbiAgICBAZGVmYXVsdCBcIiMwMDAwMDBcIlxuICAgIEB0eXBlIHtTdHJpbmcsIENvbG9yfVxuICAgICovXG5cbiAgICB0aGlzLl9jb2xvciA9IG9wdGlvbnMuY29sb3IgfHwgREVGQVVMVF9DT0xPUjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb2xvclwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29sb3I7XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbihjb2xvcikge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29sb3IgPSBjb2xvci50b1N0cmluZygpO1xuICAgICAgfSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIGlmIChvcHRpb25zLnN0cm9rZSkge1xuICAgICAgdGhpcy51c2VTdHJva2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51c2VGaWxsKCk7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIndpZHRoXCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLl9fbWVhc3VyZSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLl9fbWVhc3VyZS53aWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImhlaWdodFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5fX21lYXN1cmUpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fX21lYXN1cmUuaGVpZ2h0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKlxuICBAbWV0aG9kIHVzZVN0cm9rZVxuICAqL1xuXG5cbiAgVGV4dC5wcm90b3R5cGUudXNlU3Ryb2tlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zdHJva2UgPSB0cnVlO1xuICAgIHRoaXMuZmlsbE1ldGhvZCA9IFwic3Ryb2tlVGV4dFwiO1xuICAgIHJldHVybiB0aGlzLnN0eWxlTWV0aG9kID0gXCJzdHJva2VTdHlsZVwiO1xuICB9O1xuXG4gIC8qXG4gIEBtZXRob2QgdXNlRmlsbFxuICAqL1xuXG5cbiAgVGV4dC5wcm90b3R5cGUudXNlRmlsbCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3Ryb2tlID0gZmFsc2U7XG4gICAgdGhpcy5maWxsTWV0aG9kID0gXCJmaWxsVGV4dFwiO1xuICAgIHJldHVybiB0aGlzLnN0eWxlTWV0aG9kID0gXCJmaWxsU3R5bGVcIjtcbiAgfTtcblxuICBUZXh0LnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24oY3R4KSB7XG4gICAgY3R4LmZvbnQgPSB0aGlzLmZvbnQ7XG4gICAgY3R4LnRleHRBbGlnbiA9IHRoaXMuYWxpZ247XG4gICAgY3R4LnRleHRCYXNlbGluZSA9IHRoaXMuYmFzZWxpbmU7XG4gICAgY3R4W3RoaXMuc3R5bGVNZXRob2RdID0gdGhpcy5jb2xvcjtcbiAgICBjdHhbdGhpcy5maWxsTWV0aG9kXSh0aGlzLnRleHQsIDAsIDApO1xuICAgIHJldHVybiB0aGlzLmdldE1lYXN1cmUoY3R4KTtcbiAgfTtcblxuICAvKlxuICBAbWV0aG9kIGdldE1lYXN1cmVcbiAgQHJldHVybiB7VGV4dE1ldHJpY3N9IHRleHQgbWV0cmljc1xuICAqL1xuXG5cbiAgVGV4dC5wcm90b3R5cGUuZ2V0TWVhc3VyZSA9IGZ1bmN0aW9uKGN0eCkge1xuICAgIHZhciBtO1xuICAgIHRoaXMuX19tZWFzdXJlID0ge307XG4gICAgbSA9IFRleHQuTWVhc3VyZVRleHQodGhpcy50ZXh0LCB0aGlzLmZvbnQpO1xuICAgIHRoaXMuX19tZWFzdXJlLndpZHRoID0gbVswXTtcbiAgICByZXR1cm4gdGhpcy5fX21lYXN1cmUuaGVpZ2h0ID0gbVsxXTtcbiAgfTtcblxuICBUZXh0LkJBU0VMSU5FID0gQkFTRUxJTkU7XG5cbiAgVGV4dC5NZWFzdXJlVGV4dCA9IGZ1bmN0aW9uKHRleHQsIGZvbnQpIHtcbiAgICB2YXIgZGl2LCBzaXplLCBzdHI7XG4gICAgc3RyID0gdGV4dCArIFwiOlwiICsgZm9udDtcbiAgICBpZiAodHlwZW9mIHRoaXMuX19tZWFzdXJldGV4dF9jYWNoZV9fID09PSBcIm9iamVjdFwiICYmIHRoaXMuX19tZWFzdXJldGV4dF9jYWNoZV9fW3N0cl0pIHtcbiAgICAgIHJldHVybiB0aGlzLl9fbWVhc3VyZXRleHRfY2FjaGVfX1tzdHJdO1xuICAgIH1cbiAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiRElWXCIpO1xuICAgIGRpdi5pbm5lckhUTUwgPSB0ZXh0O1xuICAgIGRpdi5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICBkaXYuc3R5bGUudG9wID0gXCItMTAwcHhcIjtcbiAgICBkaXYuc3R5bGUubGVmdCA9IFwiLTEwMHB4XCI7XG4gICAgZGl2LnN0eWxlLmZvbnQgPSBmb250O1xuICAgIGNvbnNvbGUubG9nKGRpdi5zdHlsZS5mb250RmFtaWx5LCBkaXYuc3R5bGUuZm9udFdlaWdodCwgZGl2LnN0eWxlLmZvbnRTaXplKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRpdik7XG4gICAgc2l6ZSA9IFtkaXYub2Zmc2V0V2lkdGgsIGRpdi5vZmZzZXRIZWlnaHRdO1xuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZGl2KTtcbiAgICBpZiAodHlwZW9mIHRoaXMuX19tZWFzdXJldGV4dF9jYWNoZV9fICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICB0aGlzLl9fbWVhc3VyZXRleHRfY2FjaGVfXyA9IHt9O1xuICAgIH1cbiAgICB0aGlzLl9fbWVhc3VyZXRleHRfY2FjaGVfX1tzdHJdID0gc2l6ZTtcbiAgICByZXR1cm4gc2l6ZTtcbiAgfTtcblxuICByZXR1cm4gVGV4dDtcblxufSkoV2lkZ2V0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBUZXh0O1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9dGV4dC5tYXBcbiovXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG52YXIgQ29sb3IsIENvcmUsIE1hdHJpeDJkLCBTdXBwb3J0LCBVVUlELCBWZWN0b3IyZCwgV2lkZ2V0O1xuXG5Db3JlID0gcmVxdWlyZShcIi4uL2NvcmVcIik7XG5cblVVSUQgPSByZXF1aXJlKFwiLi4vbWF0aC91dWlkXCIpO1xuXG5WZWN0b3IyZCA9IHJlcXVpcmUoXCIuLi9tYXRoL3ZlY3RvcjJkXCIpO1xuXG5NYXRyaXgyZCA9IHJlcXVpcmUoXCIuLi9tYXRoL21hdHJpeDJkXCIpO1xuXG5TdXBwb3J0ID0gcmVxdWlyZShcIi4uL2NvcmUvc3VwcG9ydFwiKTtcblxuQ29sb3IgPSByZXF1aXJlKFwiLi4vdXRpbHMvY29sb3JcIik7XG5cbi8qXG5CYXNlIHJlbmRlcmFibGUgZWxlbWVudFxuKi9cblxuXG5XaWRnZXQgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIFdpZGdldChvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICB0aGlzLmlkID0gVVVJRC5nZW5lcmF0ZVVuaXF1ZUlkKCk7XG4gICAgLypcbiAgICBAYXR0cmlidXRlIHBpdm90XG4gICAgQHR5cGUge1ZlY3RvcjJkfVxuICAgIEBkZWZhdWx0IDAsMFxuICAgICovXG5cbiAgICB0aGlzLnBpdm90ID0gb3B0aW9ucy5waXZvdCB8fCBuZXcgVmVjdG9yMmQob3B0aW9ucy5waXZvdFggfHwgMCwgb3B0aW9ucy5waXZvdFkgfHwgMCk7XG4gICAgLypcbiAgICBAYXR0cmlidXRlIHNrZXdYXG4gICAgQHR5cGUge051bWJlcn1cbiAgICBAZGVmYXVsdCAwXG4gICAgKi9cblxuICAgIHRoaXMuc2tldyA9IG9wdGlvbnMuc2tldyB8fCBuZXcgVmVjdG9yMmQob3B0aW9ucy5za2V3WCB8fCAwLCBvcHRpb25zLnNrZXdZIHx8IDApO1xuICAgIC8qXG4gICAgQGF0dHJpYnV0ZSBzY2FsZVxuICAgIEB0eXBlIHtWZWN0b3IyZH1cbiAgICBAZGVmYXVsdCAxLDFcbiAgICAqL1xuXG4gICAgdGhpcy5zY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgbmV3IFZlY3RvcjJkKG9wdGlvbnMuc2NhbGVYIHx8IDEsIG9wdGlvbnMuc2NhbGVZIHx8IDEpO1xuICAgIC8qXG4gICAgQGF0dHJpYnV0ZSBhbHBoYVxuICAgIEB0eXBlIHtOdW1iZXJ9XG4gICAgQGRlZmF1bHQgMVxuICAgICovXG5cbiAgICB0aGlzLmFscGhhID0gKHR5cGVvZiBvcHRpb25zLmFscGhhID09PSBcInVuZGVmaW5lZFwiID8gMSA6IG9wdGlvbnMuYWxwaGEpO1xuICAgIC8qXG4gICAgQGF0dHJpYnV0ZSByb3RhdGlvblxuICAgIEB0eXBlIHtOdW1iZXJ9XG4gICAgQGRlZmF1bHQgMFxuICAgICovXG5cbiAgICB0aGlzLnJvdGF0aW9uID0gb3B0aW9ucy5yb3RhdGlvbiB8fCAwO1xuICAgIC8qXG4gICAgQGF0dHJpYnV0ZSBzbW9vdGhcbiAgICBAdHlwZSB7Qm9vbGVhbn1cbiAgICBAZGVmYXVsdCBmYWxzZVxuICAgICovXG5cbiAgICB0aGlzLnNtb290aCA9ICh0eXBlb2Ygb3B0aW9ucy5zbW9vdGggPT09IFwidW5kZWZpbmVkXCIgPyB0cnVlIDogb3B0aW9ucy5zbW9vdGgpO1xuICAgIHRoaXMuX21hdHJpeCA9IE1hdHJpeDJkLmlkZW50aXR5LmNsb25lKCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicG9zaXRpb25cIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9wb3NpdGlvbikge1xuICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gbmV3IFZlY3RvcjJkKDAsIDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbjtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHZlY3Rvcikge1xuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24gPSB2ZWN0b3IuY2xvbmUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJ4XCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uLnggfHwgMDtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb24ueCA9IHg7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKG9wdGlvbnMueCkge1xuICAgICAgdGhpcy54ID0gb3B0aW9ucy54O1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJ5XCIsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uLnkgfHwgMDtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb24ueSA9IHk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKG9wdGlvbnMueSkge1xuICAgICAgdGhpcy55ID0gb3B0aW9ucy55O1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJ3aWR0aFwiLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGggfHwgMTA7XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbih3KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl93aWR0aCA9IHc7XG4gICAgICB9LFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgaWYgKG9wdGlvbnMud2lkdGgpIHtcbiAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJoZWlnaHRcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodCB8fCAxMDtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodCA9IGg7XG4gICAgICB9LFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgaWYgKG9wdGlvbnMuaGVpZ2h0KSB7XG4gICAgICB0aGlzLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJwYXJlbnRcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudCB8fCAndW5kZWZpbmVkJztcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHBhcmVudCkge1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQuYWRkQ2hpbGQodGhpcyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKG9wdGlvbnMucGFyZW50KSB7XG4gICAgICB0aGlzLnBhcmVudCA9IG9wdGlvbnMucGFyZW50O1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJkcmF3Qm91bmRpbmdCb3hcIiwge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JvdW5kaW5nX2JveCB8fCBmYWxzZTtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKGJvb29sKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ib3VuZGluZ19ib3ggPSBib29vbCB8fCBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy5iYm94KSB7XG4gICAgICB0aGlzLmRyYXdCb3VuZGluZ0JveCA9IG9wdGlvbnMuYmJveDtcbiAgICB9XG4gIH1cblxuICBXaWRnZXQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGN0eCkge1xuICAgIHZhciBiaXQsIG10eDtcbiAgICBiaXQgPSB7XG4gICAgICBcImZhbHNlXCI6IC0xLFxuICAgICAgXCJ0cnVlXCI6IDFcbiAgICB9O1xuICAgIG10eCA9IHRoaXMuX21hdHJpeC5jbG9uZSgpLmlkZW50aXR5KCkuYXBwZW5kVHJhbnNmb3JtKHRoaXMucG9zaXRpb24ueCArIHRoaXMud2lkdGggKiAodGhpcy5mbGlwWCArIDApLCB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLmhlaWdodCAqICh0aGlzLmZsaXBZICsgMCksIHRoaXMuc2NhbGUueCAqIGJpdFshdGhpcy5mbGlwWF0sIHRoaXMuc2NhbGUueSAqIGJpdFshdGhpcy5mbGlwWV0sIHRoaXMucm90YXRpb24sIHRoaXMuc2tldy54LCB0aGlzLnNrZXcueSwgdGhpcy5waXZvdC54LCB0aGlzLnBpdm90LnkpO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgudHJhbnNsYXRlKHRoaXMucG9zaXRpb24ueCwgdGhpcy5wb3NpdGlvbi55KTtcbiAgICBjdHgudHJhbnNmb3JtKG10eC5tMTEsIG10eC5tMTIsIG10eC5tMjEsIG10eC5tMjIsIG10eC5keCwgbXR4LmR5KTtcbiAgICBjdHguc2V0QWxwaGEodGhpcy5hbHBoYSk7XG4gICAgaWYgKHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uKSB7XG4gICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gdGhpcy5jb21wb3NpdGVPcGVyYXRpb247XG4gICAgfVxuICAgIGN0eFtTdXBwb3J0LmltYWdlU21vb3RoaW5nRW5hYmxlZF0gPSB0aGlzLnNtb290aDtcbiAgICBpZiAodGhpcy5kcmF3Qm91bmRpbmdCb3ggPT09IHRydWUpIHtcbiAgICAgIGN0eC5zZXRBbHBoYSgxKTtcbiAgICAgIGN0eC5yZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICB9XG4gICAgY3R4LnNldEFscGhhKHRoaXMuYWxwaGEpO1xuICAgIGlmICh0aGlzLl9yZW5kZXIpIHtcbiAgICAgIHRoaXMuX3JlbmRlcihjdHgpO1xuICAgIH1cbiAgICBjdHgudHJhbnNsYXRlKC10aGlzLnBvc2l0aW9uLngsIC10aGlzLnBvc2l0aW9uLnkpO1xuICAgIHJldHVybiBjdHguY2xvc2VQYXRoKCk7XG4gIH07XG5cbiAgcmV0dXJuIFdpZGdldDtcblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBXaWRnZXQ7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD13aWRnZXQubWFwXG4qL1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xudmFyIENvbG9yO1xuXG5Db2xvciA9IChmdW5jdGlvbigpIHtcbiAgLypcbiAgQHBhcmFtIHtTdHJpbmcgfCBOdW1iZXJ9IGhleE9yUmVkIGhleGFkZWNpbWFsIGNvbG9yIChTdHJpbmcpLCBvciByZWQgKE51bWJlcilcbiAgQHBhcmFtIHtOdW1iZXJ9IGdyZWVuXG4gIEBwYXJhbSB7TnVtYmVyfSBibHVlXG4gIEBwYXJhbSB7TnVtYmVyfSBhbHBoYVxuICBcbiAgQGV4YW1wbGVcbiAgLy8gY29sb3IgbmFtZVxuICB2YXIgY29sb3IgPSBuZXcgSm95LkNvbG9yKFwicmVkXCIpO1xuICBcbiAgQGV4YW1wbGVcbiAgLy8gaGV4YWRlY2ltYWxcbiAgdmFyIGNvbG9yID0gbmV3IEpveS5Db2xvcihcIiNmZmZcIik7XG4gIFxuICBAZXhhbXBsZVxuICAvLyByZ2JcbiAgdmFyIGNvbG9yID0gbmV3IEpveS5Db2xvcigyNTUsIDUwLCAyNTUpO1xuICBcbiAgQGV4YW1wbGVcbiAgLy8gcmdiYVxuICB2YXIgY29sb3IgPSBuZXcgSm95LkNvbG9yKDI1NSwgNTAsIDI1NSwgMTAwKTtcbiAgXG4gIEBjbGFzcyBDb2xvclxuICBAY29uc3RydWN0b3JcbiAgKi9cblxuICBmdW5jdGlvbiBDb2xvcihyLCBnLCBiLCBhKSB7XG4gICAgdGhpcy5yID0gciAhPSBudWxsID8gciA6IDA7XG4gICAgdGhpcy5nID0gZyAhPSBudWxsID8gZyA6IDA7XG4gICAgdGhpcy5iID0gYiAhPSBudWxsID8gYiA6IDA7XG4gICAgdGhpcy5hID0gYSAhPSBudWxsID8gYSA6IDE7XG4gIH1cblxuICBDb2xvci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcjtcbiAgICBpZiAoIXRoaXMuZ3JlZW4gJiYgIXRoaXMuYmx1ZSkge1xuICAgICAgciA9IHRoaXMucmVkO1xuICAgIH0gZWxzZSBpZiAodGhpcy5hbHBoYSkge1xuICAgICAgciA9IFwicmdiYSggXCIgKyB0aGlzLnJlZCArIFwiLCBcIiArIHRoaXMuZ3JlZW4gKyBcIiwgXCIgKyB0aGlzLmJsdWUgKyBcIiwgXCIgKyB0aGlzLmFscGhhICsgXCIpXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHIgPSBcInJnYiggXCIgKyB0aGlzLnJlZCArIFwiLCBcIiArIHRoaXMuZ3JlZW4gKyBcIiwgXCIgKyB0aGlzLmJsdWUgKyBcIilcIjtcbiAgICB9XG4gICAgcmV0dXJuIHI7XG4gIH07XG5cbiAgQ29sb3IucmFuZG9tID0gZnVuY3Rpb24oYWxwaGEpIHtcbiAgICBpZiAoYWxwaGEgPT0gbnVsbCkge1xuICAgICAgYWxwaGEgPSAyNTU7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQ29sb3IocGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIDI1NSwgMTApLCBwYXJzZUludChNYXRoLnJhbmRvbSgpICogMjU1LCAxMCksIHBhcnNlSW50KE1hdGgucmFuZG9tKCkgKiAyNTUsIDEwKSwgYWxwaGEpO1xuICB9O1xuXG4gIHJldHVybiBDb2xvcjtcblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBDb2xvcjtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPWNvbG9yLm1hcFxuKi9cbiJdfQ==
;